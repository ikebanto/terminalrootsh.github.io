---
layout: post
title: " Gravando sessões do terminal Linux utilizando ttyrec"
date: '2015-06-04T06:09:00.000-07:00'
description: " Gravando sessões do terminal Linux utilizando ttyrec"
main-class: 'linux'
color: '#3b5998'
author: Marcos Oliveira
tags:
- Linux
- userlike
- Multimídia
- Dicas
- Terminal
- Comandos
modified_time: '2015-06-04T06:09:03.842-07:00'
thumbnail: http://3.bp.blogspot.com/-hXgViazGFTQ/VXBNyKFaPXI/AAAAAAAABWE/hIIG5Jax7Ak/s72-c/ttyrec.jpg
twitter_text: " Gravando sessões do terminal Linux utilizando ttyrec"
introduction: " Gravando sessões do terminal Linux utilizando ttyrec"
---

<div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-hXgViazGFTQ/VXBNyKFaPXI/AAAAAAAABWE/hIIG5Jax7Ak/s1600/ttyrec.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="260" src="http://3.bp.blogspot.com/-hXgViazGFTQ/VXBNyKFaPXI/AAAAAAAABWE/hIIG5Jax7Ak/s320/ttyrec.jpg" width="320" /></a></div><br /><div id="ter"><strong>INTRODUÇÃO</strong> O&nbsp;ttyrec&nbsp;é um software que permite gravar  tudo que for feito no terminal do Linux.  Com ele é possível gravar a  saída TTY de um programa em modo de texto juntamente com a data e hora  e, em seguida, exibi-lo como se fosse um vídeo. É muito útil para  realizar auditorias em servidores Linux.  Este breve tutorial tem como  objetivo demonstrar a instalação e a utilização do software em um  ambiente rodando Debian 7 mas nada impede de ser instalado em outras  distribuições.  Mais informações podem ser encontradas em:  <a href="http://0xcc.net/ttyrec/index.html.en"> http://0xcc.net/ttyrec/index.html.en</a>    <strong>PROCEDIMENTOS</strong> Primeiramente, faça o&nbsp;login no servidor e como root rode os seguintes comandos:     {% highlight bash %}# apt-get update{% endhighlight %} {% highlight bash %}# apt-get install&nbsp;ttyrec{% endhighlight %}    Feito isso o software já estará instalado e pronto para uso. Veja  algumas das opções que podem ser utilizadas para gravar:  A opção  -a&nbsp;permite &nbsp;anexar a saída para o arquivo ou ttyrecord, ao invés de  substituí-lo.  <strong>Exemplo:</strong> {% highlight bash %}#&nbsp;ttyrec -a arquivo.rec{% endhighlight %}    A opção&nbsp;-u&nbsp;chama automaticamente uudecode e salva sua saída quando  os dados uuencoded aparecer na sessão. Ele permitirá que você transfira  arquivos de hosts remotos. Você pode chamar o ttyrec com esta opção,  acessar o host remoto e invocar uuencode com ele para o arquivo que você  deseja transferir.  <strong>Exemplo:</strong> {% highlight bash %}#&nbsp;ttyrec -u arquivo.rec{% endhighlight %}    A opção -e é utilizada para que você possa monitorar a saída de um  comando. Pode-se gravar apenas a execução do comando find.  <strong>Exemplo:</strong> {% highlight bash %}#&nbsp;ttyrec -e find{% endhighlight %}    Para reproduzir as gravações utilizaremos o ttyplay.  A opção -n  mostra na tela a saída de todos os comandos que foram executados,  parecidos com o comando history.  <strong>Exemplo:</strong> {% highlight bash %}#&nbsp;ttyplay -n&nbsp;arquivo.rec{% endhighlight %}    A opção -s determina a velocidade de reprodução. Varia de 1 (velocidade normal) a 10 (rápido)  <strong>Exemplo:</strong> {% highlight bash %}#&nbsp;ttyplay -s 5 arquivo.rec{% endhighlight %}    No comando acima o vídeo será reproduzido 5 vezes mais rápido que o normal.  <span style="color: red;">{% highlight bash %}Obs: As opções citadas acima foram retiradas do manual do ttyrec para mais acesse man ttyrec no seu terminal.{% endhighlight %}</span>    Criando um script para gravar todas as sessões do terminal assim que  um usuário logar no servidor  Primeiro, iremos criar o diretório onde  ficarão os arquivos do ttyrec, eu por exemplo costumo usar o caminho  /sis-bkp/audit/ttyrec&nbsp;porém você pode modificar da forma que achar  necessário.     {% highlight bash %}#&nbsp;mkdir -m 777 -p /sis-bkp/audit/ttyrec{% endhighlight %}    O comando acima cria todos os diretórios &nbsp;{% highlight bash %}(opção -p){% endhighlight %} e ainda seta a permissão 777 para o diretório ttyrec &nbsp;{% highlight bash %}(opção -m 777){% endhighlight %} para que todos os usuários do sistema consiga escrever no mesmo.  Para  finalizar, precisaremos&nbsp;&nbsp;editar o arquivo&nbsp;/etc/profile, que&nbsp;será  responsável por chamar o utilitário ttyrec para gravar as sessões para  gravar a sessão de&nbsp;qualquer &nbsp;usuário que se conectar no servidor.   Primeiro faça um backup do arquivo original para restaurar caso haja  problemas:     {% highlight bash %}cp /etc/profile &nbsp;/etc/profile.bkp{% endhighlight %}    Depois com um editor de sua preferência. Eu utilizei o vim.     {% highlight bash %}#&nbsp;vim /etc/profile{% endhighlight %}    No final do arquivo, salte uma linha e inclua:     {% highlight bash %}#-- Gravar sessões do terminal{% endhighlight %} {% highlight bash %}if [ `id -u` ];{% endhighlight %} {% highlight bash %}then{% endhighlight %}{% highlight bash %} LOG="/sis-bkp/audit/ttyrec/log-${LOGNAME}-"`date +%d-%m-%Y_%H:%M`".rec"{% endhighlight %}{% highlight bash %} ttyrec -u $LOG{% endhighlight %}{% highlight bash %} fi{% endhighlight %} #-- Fim gravar sessões do terminal     Salve o arquivo e estará pronto.  Toda vez que um usuário logar no sistema, será gerado um arquivo com  extensão .rec dentro de {% highlight bash %}/sis-bkp/audit/ttyrec{% endhighlight %} com o seguinte formato:     {% highlight bash %}log-usuário-data_hora.rec{% endhighlight %}    <span style="color: red;">{% highlight bash %}Obs:  Caso o seu servidor permita acesso via ssh para o usuário root, remova  para que não haja confusão de quem logou no mesmo. Deixe apenas que  usuários comuns possam logar via ssh pois assim o log será gerado com o  nome do usuário.{% endhighlight %}</span></div><h1 style="color: blue;"><br /></h1>Por Clediomir SIlva<br /><br />