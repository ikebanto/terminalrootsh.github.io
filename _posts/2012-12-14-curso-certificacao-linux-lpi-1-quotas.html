---
layout: post
title: 'Curso Certificação Linux LPI-1: Quotas de Disco'
date: '2012-12-14T06:00:00.000-08:00'
author: The Bang Bash
tags:
- Linux
- LPI
modified_time: '2013-05-03T07:16:06.024-07:00'
thumbnail: http://3.bp.blogspot.com/-2ESRGiS34ck/UMsv1l9LTMI/AAAAAAAAA1w/kRqpyy8uA0A/s72-c/imagem.php.jpg
blogger_id: tag:blogger.com,1999:blog-2422865715758349944.post-1001016636617182024
blogger_orig_url: http://www.terminalroot.com.br/2012/12/curso-certificacao-linux-lpi-1-quotas.html
---

<!-------------------------------------------------><script type="text/javascript"><!-- google_ad_client = "ca-pub-5528601613414387"; google_ad_host = "pub-1556223355139109"; /* quadrados */ google_ad_slot = "9713010559"; google_ad_width = 200; google_ad_height = 200; //</script><script src="http://pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript"></script><!-----------------------------------------------><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-2ESRGiS34ck/UMsv1l9LTMI/AAAAAAAAA1w/kRqpyy8uA0A/s1600/imagem.php.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="300" src="http://3.bp.blogspot.com/-2ESRGiS34ck/UMsv1l9LTMI/AAAAAAAAA1w/kRqpyy8uA0A/s320/imagem.php.jpg" width="300" /></a></div><br /><br /><blockquote class="tr_bq">&nbsp; <b>No Linux existe a possibilidade de habilitarmos quotas de disco para gerenciarmos melhor o uso do espaço disponível em disco.Este recurso é especialmente importante em ambientes multi-usuários, servidores de Web, servidores de arquivos, servidores de e-mail, etc.</b><br /><b>&nbsp; </b><br /><b>&nbsp; No gerenciamento de cotas é possível definirmos a quantidade de espaço em disco para cada usuário ou grupo de usuários.É preciso habilitar o gerenciamento de quotas antes de utilizarmos este recurso.Também é preciso que o suporte a quotas esteja compilado no Kernel.</b></blockquote>&nbsp; <br />&nbsp; <b>1-Edite o arquivo </b><i>/etc/fstab</i><b> e adicione o gerenciamento de cota para usuário (usrquota) e para grupo (grpquota) no dispositivo desejado.</b><br /><b>&nbsp; </b><br /><b>&nbsp; {% highlight bash %}# vi /etc/fstab{% endhighlight %}</b><br /><b><br /></b><b>&nbsp; <span style="color: red;">Acrescentar "usrquota" e "gprquota":</span></b><br /><b>&nbsp; </b><br /><b>&nbsp; {% highlight bash %} /dev/hda6 /home ext3 defaults,<span style="color: red;">usrquota,grpquota</span> 1 2{% endhighlight %}</b><br /><b><br /></b><b>&nbsp; 2-Crie o arquivo quota.user e quota.group no diretório </b><i>/home</i><b> e configure as permissões de leitura e escrita para o root.Estes dois arquivos serão os bancos de dados para quotas de usuário e grupo respectivamente.</b><br /><b>&nbsp; </b><br /><b>&nbsp; Cria os arquivos de quota:</b><br /><b>&nbsp; </b><br /><b>&nbsp; {% highlight bash %}<br />&nbsp; # touch /home/quota.user<br />&nbsp; # touch /home/quota.group<br />&nbsp; {% endhighlight %}</b><br /><b>&nbsp; </b><br /><b>&nbsp; Altera as permissões:</b><br /><b>&nbsp; </b><br /><b>&nbsp; {% highlight bash %}<br />&nbsp; # chmod 600 /home/quota.user<br />&nbsp; # chmod 600 /home/quota.group<br />&nbsp; {% endhighlight %}</b><br /><b>&nbsp; </b><br /><b>&nbsp; 3-Execute o comando quota-check para iniciar o banco de dados recém criado, e verifique se o banco de dados foi iniciado.Os arquivos quota.user e quota.group não devem ter tamanho zero.</b><br /><b>&nbsp; </b><br /><b>&nbsp; {% highlight bash %}# ls -lga /home{% endhighlight %}</b><br /><b>&nbsp; </b><br /><b>&nbsp; 4-Habilite o serviço de quotas:</b><br /><b>&nbsp; </b><br /><b>&nbsp; {% highlight bash %}# quotaon -a{% endhighlight %}</b><br /><b>&nbsp; </b><br /><b>&nbsp; 5-Tenha certeza de que o serviço de quotas é habilitado no boot.Se não existir o arquivo </b><i>/etc/rc.d/quotas</i><b>, crie um arquivo de script:</b><br /><b>&nbsp; {% highlight bash %}<br />&nbsp; # vi /etc/rc.d/quotas<br />&nbsp; #!/bin/bash<br />&nbsp; /sbin/quotaon -avug<br />&nbsp; {% endhighlight %}</b><br /><b>&nbsp; </b><br /><b>&nbsp; Altere as permissões para 755:</b><br /><b>&nbsp; </b><br /><b>&nbsp; {% highlight bash %}# chmod 755 /etc/rc.d/quotas{% endhighlight %}</b><br /><b>&nbsp; </b><br /><b>&nbsp; 6-Crie o link simbólico para o arquivo de quotas para o runlevel 3 e runlevel 5:</b><br /><b>&nbsp; </b><br /><b>&nbsp; {% highlight bash %}<br />&nbsp; # ln -s /etc/rc.d/quotas /etc/rc.d/rc3.d/S20quotas<br />&nbsp; # ln -s /etc/rc.d/quotas /etc/rc.d/rc5.d/S20quotas<br />&nbsp; {% endhighlight %}</b><br /><b>&nbsp; </b><br /><b>&nbsp; 7-Faça checagem do sistema de quotas uma vez por semana colocando o comando quotacheck no cron do root:</b><br /><b>&nbsp; </b><br /><b>&nbsp; {% highlight bash %}<br />&nbsp; # crontab -e<br />&nbsp; 0 3 * * 0 /sbin/quotacheck -avug<br />&nbsp; {% endhighlight %}</b><br /><b>&nbsp; </b><br /><b>&nbsp; Uma vez feitos estes passos o sistema de quotas poderá ser utilizado.</b><br /><b>&nbsp; </b><br /><blockquote class="tr_bq"><b>&nbsp; - user hard limit (limite físico), é a quantidade total de espaço em disco que um usuário pode ter.</b><br /><b>&nbsp; </b><br /><b>&nbsp; - user soft limits (limite leve), funciona como uma área de aviso, quando o usuário alcança este limite o sistema avisa ao usuário que o espaço físico está acabando.</b><br /><b>&nbsp; </b><br /><b>&nbsp; - group hard limit (limite físico por grupo)</b><br /><b>&nbsp; </b><br /><b>&nbsp; - group soft limit , também área de aviso.</b><br /><b>&nbsp; </b><br /><b>&nbsp; - grace período (Período de Graça), pode-se configurar um período para que o usuário ou grupo que tenha atingido o limite leve possa apagar alguns arquivos e ficar dentro do estabelecido.Este limite pode ser em minutos, horas, dias, semanas e até meses.</b></blockquote><b>&nbsp; </b><br /><b>&nbsp; <span style="font-size: large;">Comandos</span>:</b><br /><b>&nbsp; </b><br /><b>&nbsp; <u><i>quota</i></u>:</b><br /><b>&nbsp; {% highlight bash %}<br />&nbsp; # quota [opções] usuário/grupo<br />&nbsp; {% endhighlight %}</b><br /><b>&nbsp; </b><br /><b>&nbsp; Ex.:</b><br /><b>&nbsp; {% highlight bash %}<br />&nbsp; # quota -v marcos<br />&nbsp; {% endhighlight %}</b><br /><b>&nbsp; </b><br /><b>&nbsp; O usuário marcos está usando 18320 blocos.O limite leve são 19000 blocos e o físico 20000 blocos.</b><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-1oiypiasLII/UMswih5GIBI/AAAAAAAAA14/w4gNnE5r4zA/s1600/2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="43" src="http://3.bp.blogspot.com/-1oiypiasLII/UMswih5GIBI/AAAAAAAAA14/w4gNnE5r4zA/s320/2.png" width="320" /></a></div><b>&nbsp; </b><br /><b>&nbsp; </b><br /><b>&nbsp; <u><i>quotaon</i></u>:</b><br /><b>&nbsp; {% highlight bash %}<br />&nbsp; # quotaon [opções] [dispositivos]<br />&nbsp; {% endhighlight %}</b><br /><b>&nbsp; </b><br /><b>&nbsp; Ex.(habilita quotas de usuários e grupos para todos os dispositivos):</b><br /><b>&nbsp; {% highlight bash %}# quotaon -avug{% endhighlight %}</b><br /><b>&nbsp; </b><br /><b>&nbsp; <u><i>quotaoff</i></u>:</b><br /><b>&nbsp; {% highlight bash %}<br />&nbsp; # quotaoff [opções] [dispositivo]<br />&nbsp; {% endhighlight %}</b><br /><b>&nbsp; </b><br /><b>&nbsp; Ex.(desabilita o gerenciamento de quotas num determinado dispositivo.):</b><br /><b><br /></b><b>&nbsp; <u><i>quotaon</i></u>:</b><br /><b>&nbsp; {% highlight bash %} # quotaoff -gu /dev/hda6{% endhighlight %}</b><br /><b>&nbsp; </b><br /><b>&nbsp; <u><i>quotacheck</i></u>(faz uma varredura em determinado dispositivo e constrói os arquivos de banco de dados de quotas):</b><br /><b>&nbsp; {% highlight bash %}<br />&nbsp; # quotacheck [opções] [dispositivo]<br />&nbsp; {% endhighlight %}</b><br /><b>&nbsp; </b><br /><b>&nbsp; <u><i>edquota</i></u>(Este comando edita quotas para usuários e grupos):</b><br /><b>&nbsp; {% highlight bash %}<br />&nbsp; # edquota [opções] usuário/grupo<br />&nbsp; {% endhighlight %}</b><br /><b>&nbsp; </b><br /><b>&nbsp; <u><i>repquota</i></u>(cria um relatório das quotas e utilização do disco dos usuários):</b><br /><b>&nbsp; </b>{% highlight bash %}<b><br />&nbsp; # repquota [opções] [dispositivo]</b><br />&nbsp; {% endhighlight %}