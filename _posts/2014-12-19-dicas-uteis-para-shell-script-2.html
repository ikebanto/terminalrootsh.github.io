---
layout: post
title: Dicas úteis para Shell Script 2
date: '2014-12-19T12:57:00.000-08:00'
author: Marcos Oliveira
tags:
- Shell Script
- Dicas
modified_time: '2014-12-19T12:57:52.339-08:00'
thumbnail: http://1.bp.blogspot.com/-FkPcIsY-8fU/Ub4bRVwYWsI/AAAAAAAAB6I/UlsSTr0GR6s/s72-c/shell+script.png
blogger_id: tag:blogger.com,1999:blog-2422865715758349944.post-3308614929157338205
blogger_orig_url: http://www.terminalroot.com.br/2014/12/dicas-uteis-para-shell-script-2.html
---

<br /><div style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-FkPcIsY-8fU/Ub4bRVwYWsI/AAAAAAAAB6I/UlsSTr0GR6s/s200/shell+script.png" height="200" width="200" /></div><br /><br /><blockquote class="tr_bq"><b>Digitar Script no terminal utilizando <span style="color: blue;">EOF</span> (<span style="font-size: x-small;"><i>End Of File</i></span>), serve para agilizar digitalização de qualquer coisa e já salvar via terminal, para finalizar, basta escrever em maiúsculo: <span style="color: blue;">EOF</span> e pressionar <span style="color: purple;">[ENTER]</span>, pode-se usar <span style="color: blue;">EOS</span> (<span style="font-size: x-small;"><i>End Of System</i></span>) ou <span style="color: blue;">EOL</span> (<span style="font-size: x-small;"><i>End Of Line</i></span>) também e finalizar com <span style="color: blue;">EOS</span> <span style="color: purple;">[ENTER]</span> ou <span style="color: blue;">EOL </span><span style="color: purple;">[ENTER]</span>, da mesma forma ou diferente como apresentada abaixo:</b></blockquote><b><br />{% highlight bash %}<br />$ cat &lt;&lt; EOF &gt;&gt; condicao_ternaria.sh<br />&gt; #!/bin/bash<br />&gt; ping -c1 www.linux.org &amp;&amp; echo 'Rede OK' || echo 'Rede Sujou.'<br />&gt; EOF{% endhighlight %}<br /><br /><u><i>utilizando o<span style="color: blue;"> EOS</span> e uma <span style="color: blue;">condição ternária</span> com somente mensagens</i></u><br />{% highlight bash %}<br />$ cat &gt; condicao_ternaria_2_so_msg.sh &lt;&lt; EOS<br />&gt; #!/bin/bash<br />&gt; ping -c1 www.linux.org 2&gt;/dev/null 1&gt;/dev/null &amp;&amp; echo 'Rede OK' ||\ echo 'Rede Sujou.'<br />&gt; EOS{% endhighlight %}<br /><br /><i>Criando um arquivo <span style="color: blue;">sh</span> instantâneo, utilizando o <span style="color: blue;">EOL</span> e o comando <span style="color: blue;">trap</span></i><br />{% highlight bash %}<br />$ sh &lt;&lt; EOL<br />&gt; # funções tambem podem ser chamadas usando: function funcao(){}<br />&gt; # trap é o mesmo CTRL+C<br />&gt;&nbsp; function trataErro()<br />&gt;&nbsp; {<br />&gt;&nbsp; echo "Voce pressionou ctrl-c"<br />&gt;&nbsp; echo "Mas nao posso terminar agora"<br />&gt;&nbsp; }<br />&gt; <br />&gt;&nbsp; trap trataErro SIGINT SIGTERM<br />&gt; <br />&gt;&nbsp; for i in {1..10}<br />&gt;&nbsp; do<br />&gt;&nbsp;&nbsp; sleep 1<br />&gt;&nbsp;&nbsp; echo "Dormindo"<br />&gt;&nbsp; done<br />&gt; EOL{% endhighlight %}<br />&nbsp;</b><br /><b><span style="font-size: x-large;">Truques para tratamento de variáveis em shell script</span></b><br /><blockquote class="tr_bq"><b>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;As variáveis do sistema servem para armazenar algum valor (como toda variável), mas existem alguns recursos interessantes e úteis no modo de usar tais variáveis. O que aprendemos em alguns tutoriais, é que para declarar uma variável do sistema, fazemos:</b></blockquote><b>&nbsp;&nbsp; &nbsp;</b><br /><div class="adp"><b><br /></b><b>&nbsp;&nbsp; &nbsp;NOME="VALOR" &gt; Aqui podemos usar valores de outras variáveis</b><br /><b>&nbsp;&nbsp; &nbsp;NOME='VALOR' &gt; NOME terá o valor igual a VALOR</b><br /><b>&nbsp;&nbsp; &nbsp;NOME=`COMANDO` &gt; NOME terá o valor da saída de comando</b><br /><b>&nbsp;&nbsp; &nbsp;</b></div><b><br />&nbsp;&nbsp; &nbsp;Isto é o básico, agora teremos algumas coisas mais interessantes:<br /><br />&nbsp;&nbsp; &nbsp;<span style="color: blue;"><span style="font-size: large;">1. Retirar parte final de uma string</span></span><br />&nbsp;&nbsp; &nbsp;</b><br /><div class="adp"><b><br /></b><b>&nbsp;&nbsp; &nbsp;VAR="minha_foto.jpeg"</b><br /><b>&nbsp;&nbsp; &nbsp;echo ${VAR%.jpeg}</b><br /><b>&nbsp;&nbsp; &nbsp;</b></div><b><br />&nbsp;&nbsp; &nbsp;<span style="color: purple;">Saída: minha_foto</span><br /><br />&nbsp;&nbsp; &nbsp;<i>Como podemos ver, ".jpeg" será excluído. Indicamos o que será excluído depois do caracter '%'.</i><br /><br />&nbsp;&nbsp; &nbsp;<span style="color: blue;"><span style="font-size: large;">2. Retirar da variável a parte inicial do valor dado</span></span><br />&nbsp;&nbsp; &nbsp;</b><br /><div class="adp"><b><br /></b><b>&nbsp;&nbsp; &nbsp;VAR="http://www.vivaolinux.com.br"</b><br /><b>&nbsp;&nbsp; &nbsp;echo ${VAR#http://}</b><br /><b>&nbsp;&nbsp; &nbsp;</b></div><b><br />&nbsp;&nbsp; &nbsp;<span style="color: purple;">Saída: www.vivaolinux.com.br</span><br /><br />&nbsp;&nbsp; &nbsp;Indicamos o que será excluído depois do caracter '#'<br /><br />&nbsp;&nbsp; &nbsp;<span style="color: blue;"><span style="font-size: large;">3. Mostrar tudo depois de uma certa posição</span></span><br />&nbsp;&nbsp; &nbsp;</b><br /><div class="adp"><b><br /></b><b>&nbsp;&nbsp; &nbsp;VAR="http://www.g00gle.com"</b><br /><b>&nbsp;&nbsp; &nbsp;echo ${VAR:7}</b><br /><b>&nbsp;&nbsp; &nbsp;</b></div><b><br />&nbsp;&nbsp; &nbsp;<span style="color: purple;">Saída: www.g00gle.com</span><br /><br />&nbsp;&nbsp; &nbsp;Depois do ':' indicamos o índice. Como é em C, o primeiro índice é 0, o segundo é 2 ..., o oitavo é 7 ... etc.<br /><br />&nbsp;&nbsp; &nbsp;<span style="color: blue;"><span style="font-size: large;">4. Mostrar entre alguns caracteres</span></span><br />&nbsp;&nbsp; &nbsp;<div class="adp"><br />&nbsp;&nbsp; &nbsp;VAR="123456789"<br />&nbsp;&nbsp; &nbsp;echo ${VAR:2:5}<br />&nbsp;&nbsp; &nbsp;</div><br />&nbsp;&nbsp; &nbsp;<span style="color: purple;">Saída: 34567</span><br /><br />&nbsp;&nbsp; &nbsp;Primeiro, faz-se o índice 2, que começa no caracter '3'. No índice 5, a contagem já começa no índice 2 (5 caracteres a partir do índice 2), aí morre no caracter '7'.<br /><br />&nbsp;&nbsp; <span style="color: blue;"><span style="font-size: large;">&nbsp;5. Elimina o caracter mostrado e tudo a ESQUERDA</span></span><br />&nbsp;&nbsp; &nbsp;<div class="adp"><br />&nbsp;&nbsp; &nbsp;VAR="daemonio@vivaolinux"<br />&nbsp;&nbsp; &nbsp;echo ${VAR#*@}<br />&nbsp;&nbsp; &nbsp;</div><br />&nbsp;&nbsp; &nbsp;<span style="color: purple;">Saída: vivaolinux</span><br /><br />&nbsp;&nbsp; &nbsp;Bom, aqui indicamos o caracter a ser deletado e tudo a sua esquerda, depois da string "#*".<br /><br />&nbsp;&nbsp; &nbsp;<span style="color: blue;"><span style="font-size: large;">6. Elimina o caracter mostrado e tudo a DIREITA</span></span><br /><br />&nbsp;&nbsp; &nbsp;Como o mundo não é feito somente de canhotos,<br />&nbsp;&nbsp; &nbsp;<div class="adp"><br />&nbsp;&nbsp; &nbsp;VAR="daemonio@vivaolinux"<br />&nbsp;&nbsp; &nbsp;echo ${VAR%@*}<br />&nbsp;&nbsp; &nbsp;</div><br />&nbsp;&nbsp; &nbsp;<span style="color: purple;">Saída: daemonio</span><br /><br />&nbsp;&nbsp; &nbsp;Já aqui, indicamos o caracter a ser deletado e tudo a sua direita, entre a string "%*".<br /><br />&nbsp;&nbsp; &nbsp;<span style="color: blue;"><span style="font-size: large;">7. Excluir até um certo valor</span></span><br /><br />&nbsp;&nbsp; &nbsp;Esta daqui é igual ao de cima, só que podemos indicar strings ao invés de somente um caracter.<br />&nbsp;&nbsp; &nbsp;<div class="adp"><br />&nbsp;&nbsp; &nbsp;EXC=":senha"<br />&nbsp;&nbsp; &nbsp;VAR="root:senha:/bin/bash"<br /><br />&nbsp;&nbsp; &nbsp;echo ${VAR%%$EXC*}<br />&nbsp;&nbsp; &nbsp;</div><br />&nbsp;&nbsp; &nbsp;<span style="color: purple;">Saída: root</span><br /><br />&nbsp;&nbsp; &nbsp;O que será excluído tem que ficar entre "%%" e '*'.<br /><br />&nbsp;&nbsp; &nbsp;<span style="color: blue;"><span style="font-size: large;">8. Excluir de um certo valor até o final</span></span><br /><br />&nbsp;&nbsp; &nbsp;Agora é ao contrário, exclui até o final.<br />&nbsp;&nbsp; &nbsp;<div class="adp"><br />&nbsp;&nbsp; &nbsp;EXC="senha:"<br />&nbsp;&nbsp; &nbsp;VAR="root:senha:/bin/bash"<br /><br />&nbsp;&nbsp; &nbsp;echo ${VAR##*$EXC}<br />&nbsp;&nbsp; &nbsp;</div><br />&nbsp;&nbsp; &nbsp;<span style="color: purple;">Saída: /bin/bash</span><br /><br />&nbsp;&nbsp; &nbsp;O que será excluído deve ficar depois do "##*".<br /><br />&nbsp;&nbsp; &nbsp;<span style="color: blue;"><span style="font-size: large;">9. Troca-troca (de strings :-)</span></span><br /><br />&nbsp;&nbsp; &nbsp;Isto na verdade funfa que nem o comando sed.<br />&nbsp;&nbsp; &nbsp;<div class="adp"><br />&nbsp;&nbsp; &nbsp;VAR="c1:c2:c3"<br />&nbsp;&nbsp; &nbsp;echo ${VAR/:/x}<br />&nbsp;&nbsp; &nbsp;</div><br />&nbsp;&nbsp; &nbsp;<span style="color: purple;">Saída: c1xc2:c3</span><br /><br />&nbsp;&nbsp; &nbsp;Troca a primeira ocorrência de ':' por 'x', para trocar tudo:<br />&nbsp;&nbsp; &nbsp;<div class="adp"><br />&nbsp;&nbsp; &nbsp;echo ${VAR//:/x}<br />&nbsp;&nbsp; &nbsp;</div><br />&nbsp;&nbsp; &nbsp;Usa-se duas barras.<br /><br />&nbsp;&nbsp; &nbsp;Nada impede de trocar por strings:<br />&nbsp;&nbsp; &nbsp;<div class="adp"><br />&nbsp;&nbsp; &nbsp;echo ${VAR//:/-CC-}<br />&nbsp;&nbsp; &nbsp;</div><br />&nbsp;&nbsp; &nbsp;<span style="color: purple;">Saída: c1-CC-c2-CC-c3</span><br /><br />&nbsp;&nbsp; &nbsp;<span style="color: blue;"><span style="font-size: large;">10. Mostrar o comprimento da variável:</span></span><br />&nbsp;&nbsp; &nbsp;<div class="adp"><br />&nbsp;&nbsp; &nbsp;VAR="tenho 19 caracteres"<br />&nbsp;&nbsp; &nbsp;echo ${#VAR}<br />&nbsp;&nbsp; &nbsp;</div><br />&nbsp;&nbsp; &nbsp;<span style="color: purple;">Saída: 19</span><br /><br />&nbsp;&nbsp; &nbsp;<span style="color: blue;"><span style="font-size: large;">11. Listar nomes de variáveis</span></span><br /><br />&nbsp;&nbsp; &nbsp;Para listar todas as variáveis de seu sistema que contenha tal nome, faça:<br />&nbsp;&nbsp; &nbsp;<div class="adp"><br />&nbsp;&nbsp; &nbsp;echo ${!va*}<br />&nbsp;&nbsp; &nbsp;</div><br />&nbsp;&nbsp; &nbsp;Mostrará todas as variáveis que começam com "va". Aí pode sair: vaca, vacuo, vassoura, etc.<br /><br />&nbsp;&nbsp; &nbsp;<span style="color: blue;"><span style="font-size: large;">12. Um ou outro</span></span><br />&nbsp;&nbsp; &nbsp;<div class="adp"><br />&nbsp;&nbsp; &nbsp;echo ${VAR:-"eu não existo"}<br />&nbsp;&nbsp; &nbsp;</div><br />&nbsp;&nbsp; &nbsp;<span style="color: purple;">Saída: eu não existo</span><br /><br />&nbsp;&nbsp; &nbsp;Se VAR for nula, mostra "eu não existo", se não for nula, mostra o conteúdo dela.<br />&nbsp;&nbsp; &nbsp;<div class="adp"><br />&nbsp;&nbsp; &nbsp;VAR="eu existo"<br />&nbsp;&nbsp; &nbsp;echo ${VAR:-"eu não existo"}<br />&nbsp;&nbsp; &nbsp;</div><br />&nbsp;&nbsp; &nbsp;<span style="color: purple;">Saída: eu existo</span><br /><br />&nbsp;&nbsp; &nbsp;Agora, VAR não é nula, por isto mostra o conteúdo dela.<br />&nbsp;&nbsp; <br />&nbsp;&nbsp; &nbsp;Fonte: <a href="http://www.vivaolinux.com.br/dica/Truques-para-tratamento-de-variaveis-em-shell-script" target="_blank">http://www.vivaolinux.com.br/dica/Truques-para-tratamento-de-variaveis-em-shell-script</a><br />&nbsp;&nbsp; </b><br /><blockquote class="tr_bq"><b><span style="font-size: x-large;">Variáveis ambientes 2 caracteres</span></b></blockquote><b><br /> <table border="1"><tbody><tr><td>Variável</td><td>Descrição</td></tr><tr><td>$0</td><td>Parâmetro número 0 (nome do comando ou função)</td></tr></tbody></table></b><br />$1<br />Parâmetro número 1 (da linha de comando ou função)<br /> …<br />Parâmetro número N …<br /> $9<br />Parâmetro número 9 (da linha de comando ou função)<br /> ${10}<br />Parâmetro número 10 (da linha de comando ou função)<br /> $<br />Número total de parâmetros da linha de comando ou função<br /> $*<br />Todos os parâmetros, como uma string única<br /> $@<br />Todos os parâmetros, como várias strings protegidas<br /> $$<br />Número PID do processo atual (do próprio script)<br /> $!<br />Número PID do último processo em segundo plano<br /> $_<br />Último argumento do último comando executado<br /> $?<br />Valor de retorno do último comando executado<br />       