---
layout: post
title: Dicas úteis para Shell Script 2
date: '2014-12-19T12:57:00.000-08:00'
description: Dicas úteis para Shell Script 2
main-class: 'bash'
color: '#c2003a'
author: Marcos Oliveira
tags:
- Shell Script
- Dicas
modified_time: '2014-12-19T12:57:52.339-08:00'
thumbnail: http://1.bp.blogspot.com/-FkPcIsY-8fU/Ub4bRVwYWsI/AAAAAAAAB6I/UlsSTr0GR6s/s72-c/shell+script.png
twitter_text: Dicas úteis para Shell Script 2
introduction: Dicas úteis para Shell Script 2
---

<p>

<div style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-FkPcIsY-8fU/Ub4bRVwYWsI/AAAAAAAAB6I/UlsSTr0GR6s/s200/shell+script.png" height="200" width="200" /></div>

<blockquote class="tr_bq"><b>Digitar Script no terminal utilizando <span style="color: blue;">EOF</span> (<span style="font-size: x-small;"><i>End Of File</i></span>), serve para agilizar digitalização de qualquer coisa e já salvar via terminal, para finalizar, basta escrever em maiúsculo: <span style="color: blue;">EOF</span> e pressionar <span style="color: purple;">[ENTER]</span>, pode-se usar <span style="color: blue;">EOS</span> (<span style="font-size: x-small;"><i>End Of System</i></span>) ou <span style="color: blue;">EOL</span> (<span style="font-size: x-small;"><i>End Of Line</i></span>) também e finalizar com <span style="color: blue;">EOS</span> <span style="color: purple;">[ENTER]</span> ou <span style="color: blue;">EOL </span><span style="color: purple;">[ENTER]</span>, da mesma forma ou diferente como apresentada abaixo:</b></blockquote><b>
{% highlight bash %}

$ cat > condicao_ternaria.sh
> #!/bin/bash
> ping -c1 www.linux.org &amp;&amp; echo 'Rede OK' || echo 'Rede Sujou.'
> EOF
{% endhighlight %}

<u><i>utilizando o<span style="color: blue;"> EOS</span> e uma <span style="color: blue;">condição ternária</span> com somente mensagens</i></u>
{% highlight bash %}

$ cat > condicao_ternaria_2_so_msg.sh << EOS
> #!/bin/bash
> ping -c1 www.linux.org 2>/dev/null 1>/dev/null &amp;&amp; echo 'Rede OK' ||\ echo 'Rede Sujou.'
> EOS
{% endhighlight %}

<i>Criando um arquivo <span style="color: blue;">sh</span> instantâneo, utilizando o <span style="color: blue;">EOL</span> e o comando <span style="color: blue;">trap</span></i>
{% highlight bash %}

$ sh << EOL
> # funções tambem podem ser chamadas usando: function funcao(){}
> # trap é o mesmo CTRL+C
> function trataErro()
> {
> echo "Voce pressionou ctrl-c"
> echo "Mas nao posso terminar agora"
> }
> 
> trap trataErro SIGINT SIGTERM
> 
> for i in {1..10}
> do
> sleep 1
> echo "Dormindo"
> done
> EOL
{% endhighlight %}
</b>
<p><span style="font-size: x-large;">Truques para tratamento de variáveis em shell script</span></p>
<blockquote class="tr_bq"><b>  As variáveis do sistema servem para armazenar algum valor (como toda variável), mas existem alguns recursos interessantes e úteis no modo de usar tais variáveis. O que aprendemos em alguns tutoriais, é que para declarar uma variável do sistema, fazemos:</b></blockquote><b> </b>
<div class="adp"><b>
</b><b> NOME="VALOR" > Aqui podemos usar valores de outras variáveis</b>
<p> NOME='VALOR' > NOME terá o valor igual a VALOR</p>
<p> NOME=`COMANDO` > NOME terá o valor da saída de comando</p>
<b> </b></div><b>
 Isto é o básico, agora teremos algumas coisas mais interessantes:

 <span style="color: blue;"><span style="font-size: large;">1. Retirar parte final de uma string</span></span>
 </b>
<div class="adp"><b>
</b><b> VAR="minha_foto.jpeg"</b>
<p> echo ${VAR%.jpeg}</p>
<b> </b></div><b>
 <span style="color: purple;">Saída: minha_foto</span>

 <i>Como podemos ver, ".jpeg" será excluído. Indicamos o que será excluído depois do caracter '%'.</i>

 <span style="color: blue;"><span style="font-size: large;">2. Retirar da variável a parte inicial do valor dado</span></span>
 </b>
<div class="adp"><b>
</b><b> VAR="http://www.vivaolinux.com.br"</b>
<p> echo ${VAR#http://}</p>
<b> </b></div><b>
 <span style="color: purple;">Saída: www.vivaolinux.com.br</span>

 Indicamos o que será excluído depois do caracter '#'

 <span style="color: blue;"><span style="font-size: large;">3. Mostrar tudo depois de uma certa posição</span></span>
 </b>
<div class="adp"><b>
</b><b> VAR="http://www.g00gle.com"</b>
<p> echo ${VAR:7}</p>
<b> </b></div><b>
 <span style="color: purple;">Saída: www.g00gle.com</span>

 Depois do ':' indicamos o índice. Como é em C, o primeiro índice é 0, o segundo é 2 ..., o oitavo é 7 ... etc.

 <span style="color: blue;"><span style="font-size: large;">4. Mostrar entre alguns caracteres</span></span>
 <div class="adp">
 VAR="123456789"
 echo ${VAR:2:5}
 </div>
 <span style="color: purple;">Saída: 34567</span>

 Primeiro, faz-se o índice 2, que começa no caracter '3'. No índice 5, a contagem já começa no índice 2 (5 caracteres a partir do índice 2), aí morre no caracter '7'.

 <span style="color: blue;"><span style="font-size: large;">5. Elimina o caracter mostrado e tudo a ESQUERDA</span></span>
 <div class="adp">
 VAR="daemonio@vivaolinux"
 echo ${VAR#*@}
 </div>
 <span style="color: purple;">Saída: vivaolinux</span>

 Bom, aqui indicamos o caracter a ser deletado e tudo a sua esquerda, depois da string "#*".

 <span style="color: blue;"><span style="font-size: large;">6. Elimina o caracter mostrado e tudo a DIREITA</span></span>

 Como o mundo não é feito somente de canhotos,
 <div class="adp">
 VAR="daemonio@vivaolinux"
 echo ${VAR%@*}
 </div>
 <span style="color: purple;">Saída: daemonio</span>

 Já aqui, indicamos o caracter a ser deletado e tudo a sua direita, entre a string "%*".

 <span style="color: blue;"><span style="font-size: large;">7. Excluir até um certo valor</span></span>

 Esta daqui é igual ao de cima, só que podemos indicar strings ao invés de somente um caracter.
 <div class="adp">
 EXC=":senha"
 VAR="root:senha:/bin/bash"

 echo ${VAR%%$EXC*}
 </div>
 <span style="color: purple;">Saída: root</span>

 O que será excluído tem que ficar entre "%%" e '*'.

 <span style="color: blue;"><span style="font-size: large;">8. Excluir de um certo valor até o final</span></span>

 Agora é ao contrário, exclui até o final.
 <div class="adp">
 EXC="senha:"
 VAR="root:senha:/bin/bash"

 echo ${VAR##*$EXC}
 </div>
 <span style="color: purple;">Saída: /bin/bash</span>

 O que será excluído deve ficar depois do "##*".

 <span style="color: blue;"><span style="font-size: large;">9. Troca-troca (de strings :-)</span></span>

 Isto na verdade funfa que nem o comando sed.
 <div class="adp">
 VAR="c1:c2:c3"
 echo ${VAR/:/x}
 </div>
 <span style="color: purple;">Saída: c1xc2:c3</span>

 Troca a primeira ocorrência de ':' por 'x', para trocar tudo:
 <div class="adp">
 echo ${VAR//:/x}
 </div>
 Usa-se duas barras.

 Nada impede de trocar por strings:
 <div class="adp">
 echo ${VAR//:/-CC-}
 </div>
 <span style="color: purple;">Saída: c1-CC-c2-CC-c3</span>

 <span style="color: blue;"><span style="font-size: large;">10. Mostrar o comprimento da variável:</span></span>
 <div class="adp">
 VAR="tenho 19 caracteres"
 echo ${#VAR}
 </div>
 <span style="color: purple;">Saída: 19</span>

 <span style="color: blue;"><span style="font-size: large;">11. Listar nomes de variáveis</span></span>

 Para listar todas as variáveis de seu sistema que contenha tal nome, faça:
 <div class="adp">
 echo ${!va*}
 </div>
 Mostrará todas as variáveis que começam com "va". Aí pode sair: vaca, vacuo, vassoura, etc.

 <span style="color: blue;"><span style="font-size: large;">12. Um ou outro</span></span>
 <div class="adp">
 echo ${VAR:-"eu não existo"}
 </div>
 <span style="color: purple;">Saída: eu não existo</span>

 Se VAR for nula, mostra "eu não existo", se não for nula, mostra o conteúdo dela.
 <div class="adp">
 VAR="eu existo"
 echo ${VAR:-"eu não existo"}
 </div>
 <span style="color: purple;">Saída: eu existo</span>

 Agora, VAR não é nula, por isto mostra o conteúdo dela.
 
 Fonte: <a href="http://www.vivaolinux.com.br/dica/Truques-para-tratamento-de-variaveis-em-shell-script" target="_blank">http://www.vivaolinux.com.br/dica/Truques-para-tratamento-de-variaveis-em-shell-script</a>
 </b>
<blockquote class="tr_bq"><b><span style="font-size: x-large;">Variáveis ambientes 2 caracteres</span></b></blockquote><b>
 <table border="1"><tbody><tr><td>Variável</td><td>Descrição</td></tr><tr><td>$0</td><td>Parâmetro número 0 (nome do comando ou função)</td></tr></tbody></table></b>
$1
Parâmetro número 1 (da linha de comando ou função)
 …
Parâmetro número N …
 $9
Parâmetro número 9 (da linha de comando ou função)
 ${10}
Parâmetro número 10 (da linha de comando ou função)
 $
Número total de parâmetros da linha de comando ou função
 $*
Todos os parâmetros, como uma string única
 $@
Todos os parâmetros, como várias strings protegidas
 $$
Número PID do processo atual (do próprio script)
 $!
Número PID do último processo em segundo plano
 $_
Último argumento do último comando executado
 $?
Valor de retorno do último comando executado
       

</p>
