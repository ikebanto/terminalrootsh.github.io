---
layout: post
title: Efetuando Upload de arquivos com PHP
date: '2011-11-21T16:01:00.000-08:00'
author: The Bang Bash
tags:
- PHP
modified_time: '2013-05-03T07:16:09.729-07:00'
blogger_id: tag:blogger.com,1999:blog-2422865715758349944.post-2042721499043719560
blogger_orig_url: http://www.terminalroot.com.br/2011/11/efetuando-upload-de-arquivos-com-php.html
---

<b>&nbsp; <span style="color: red;">Upload</span> de arquivos é um assunto complicado, pois ele é uma brecha pra varios <strike>ataques</strike> se não for feito de maneira correta.Temos que estabelecer alguns <span style="color: #274e13;">LIMITES</span> obrigatóriamente se quisermos ter segurança.</b><br /><br /><b><span style="color: red;">1°</span> - Nunca permita qualquer tipo de arquivo para upload, pricipalmente se for arquivos de script(HTML, PHP, ASP...)</b><br /><br /><b><span style="color: red;">2°</span> - Estabeleça o tamanho máximo de arquivo, pois com práticas hacker pode-se derrubar seu servidor com "Negação de Serviço".Lembrando que caso vc tenha acesso ao php.ini, vc deve configurar o tamanho permitido pelo PHP na linha que contém: <i><span style="background-color: white; color: #274e13;">upload_max_filesize</span></i>, por padrão ele está setado para aceitar 2M (2 MB), mas você pode aumentar ou diminuir este tamanho.</b><br /><b><br /></b><br /><b><span style="color: red;">3°</span> - Não mostre erros detalhados, aqui eu vou dar exemplo, mas use um único erro pra qualquer tipo de&nbsp; erro, e se quiser crie uma função pra salvar o tipo de erro pra você analisar mais tarde, no Banco de Dados.</b><br /><b><br /></b><br /><b>Há inúmeras maneiras de se fazer isso, vou tentar mostrar aqui a maneira mais simples, numa próxima postagem sobre isso, vou explicar o Upload de Múltiplos Arquivos, porém antes vou explicar melhor os arrays e algumas de suas funções, e mais tarde o mesmo assunto utilizando AJAX.</b><br /><b><br /></b><br /><b>Como de prática aqui do blog, vou publicar o arquivo(nesse caso criei o HTML e o PHP num só arquivo, requisição na própria página) e comentei de <span style="color: blue;">AZUL</span> os partes do código para causar entendimento.Verifique:</b><br /><br /><blockquote class="tr_bq"><b>upload.php</b></blockquote><br />{% highlight bash %}<br />&nbsp; &lt;form action="" method="post" enctype="multipart/form-data"&gt;<br />&nbsp; <span style="color: blue;">&lt;!--nesse input damos o nome MAX_FILE_SIZE e o Máximo de bits que ele pode ter do tipo hidden(oculto)--&gt;</span><br />&nbsp;&nbsp;&nbsp; &lt;input type="hidden" name="MAX_FILE_SIZE" value="1000000"/&gt;<br />&nbsp; <span style="color: blue;">&lt;!--nesse input damos o nome "arquivo" e o tipo de "file"--&gt;</span><br />&nbsp;&nbsp;&nbsp; Arquivo: &lt;input type="file" name="arquivo" /&gt;&lt;br /&gt;<br />&nbsp;&nbsp;&nbsp; &lt;input type="submit" name="enviar" /&gt;&lt;br /&gt;<br />&nbsp; &lt;/form&gt;<br /><br />&lt;?php<br /><br /><div style="color: blue;">&nbsp;/*se clicarmos em Enviar Dados iniciaremos a leitura desse bloco*/</div>&nbsp;if(isset($_POST['enviar'])){<br />&nbsp;&nbsp;&nbsp; <span style="color: blue;">/* dê um var_dump($_FILES) ou print_r($_FILES) pra entender melhor essa parte, são os valores do array, nome, tipo, tamanho, erro, nome temporario...*/</span><br />&nbsp;&nbsp;&nbsp; $nome = $_FILES['arquivo']['name'];<br />&nbsp;&nbsp;&nbsp; $tipo = $_FILES['arquivo']['type'];<br />&nbsp;&nbsp;&nbsp; $tmp&nbsp; = $_FILES['arquivo']['tmp_name'];<br />&nbsp;&nbsp;&nbsp; $size = $_FILES['arquivo']['size'];<br />&nbsp;&nbsp;&nbsp; $erro = $_FILES['arquivo']['error'];<br />&nbsp;&nbsp;&nbsp; <span style="color: blue;">/* aqui definimos a pasta e/ou o caminho dela para que seja enviados os arquivos */</span> &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp; $caminho&nbsp;&nbsp;&nbsp; = '/uploads/';<br />&nbsp;&nbsp;&nbsp; <span style="color: blue;">/* o caminho mais o nome do aquivo para que possamos salvar o arquivo em determinada pasta */</span><br />&nbsp;&nbsp;&nbsp; $arquivocam = $caminho . $nome;<br />&nbsp;&nbsp;&nbsp; <span style="color: blue;">/* iremos decidir qual o tamanho máximo que permitiremos do arquivo */</span><br />&nbsp;&nbsp; &nbsp;$sizemax = 1024 * 1500;<br />&nbsp;&nbsp;&nbsp; <span style="color: blue;">/* informamos quais tipos de arquivo permitiremos */</span><br />&nbsp;&nbsp; &nbsp;$somente = array('image/jpg','text/plain','image/png');<br />&nbsp;&nbsp; &nbsp;<span style="color: blue;">/*pararemos a execução do bloco caso o tamanho seja execedido */</span><br />&nbsp;&nbsp; &nbsp;if($size &gt; $sizemax){<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;die('Tamanho não permitido.');<br />&nbsp;&nbsp; &nbsp;}<br />&nbsp;&nbsp; &nbsp;<span style="color: blue;">/*pararemos a execução do bloco caso o tipo do arquivo não seja entre os permitido */</span><br />&nbsp;&nbsp; &nbsp;if(!array_search($tipo, $somente)){<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;die('tipo inválido.');<br />&nbsp;&nbsp; &nbsp;}<br />&nbsp;&nbsp; <br />&nbsp;&nbsp; &nbsp;<span style="color: blue;">/* se a chave erro for igual a 0, entraremos nesse bloco */</span><br />&nbsp;&nbsp;&nbsp; if($erro == 0){<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<span style="color: blue;">/* usamos a função move_upload_file para mover, se der certo, completaremos o processo */</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(move_uploaded_file($tmp, $arquivocam)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo "Foi carregado com sucesso o arquivo: $nome, do tipo: $tipo, com tamanho de: $size bytes!";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; chmod($arquivocam,0777);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; <span style="color: blue;">/* caso erro seja maior que zero, descobriremos qual foi o problemas, porém nesse caso é bom salvar os erros em outro lugar e mostrar somente um erro, por motivos de segurança */</span><br />&nbsp;&nbsp;&nbsp; }else{<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; switch($erro)<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 1: echo "Arquivo atingiu o tamanho máximo no PHP."; echo '&lt;br /&gt;'; break;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 2: echo "Arquivo atingiu o tamanho máximo no HTML.";echo '&lt;br /&gt;'; break;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 3: echo "Arquivo parcialmente carregado."; echo '&lt;br /&gt;'; break;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 4: echo "Erro: arquivo não carregado."; echo '&lt;br /&gt;'; break;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp;}<br />?&gt;{% endhighlight %}<br /><br /><b>Simples, num é?Pronto!</b>