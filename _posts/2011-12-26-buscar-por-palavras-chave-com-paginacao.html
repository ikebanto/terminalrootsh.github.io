---
layout: post
title: Buscar por palavras-chave com paginação em PDO
date: '2011-12-26T16:56:00.000-08:00'
description: Buscar por palavras-chave com paginação em PDO
main-class: 'misc'
color: '#34a853'
author: The Bang Bash
tags:
- MySQL
- PHP
modified_time: '2013-05-03T07:16:08.696-07:00'
twitter_text: Buscar por palavras-chave com paginação em PDO
introduction: Buscar por palavras-chave com paginação em PDO
---

<p>
<b>Fala <strike>rapaziada</strike>, mais um post até antes do fim do ano, pretendo lançar no mínimo mais uns 4 hehe...hoje vou mostrar como buscar com palavras chaves, como o <span style="font-size: x-small;">Google, o Bing, o Yahoo, o DuckDuckGo</span> e outros <u>buscadores grandes fazem, e paginam</u>, e vamos fazer tudo isso sempre com <span style="color: blue;">PDO,</span> não é só porque curto o PDO, mas é a maneira correta, vai que depois você decide mudar o banco pra pra PostGreSQL, Oracle...não precisará mudar todos.</b></p><p><b></p><p></b></p><p><b>Esse processo é bem simples, apesar de alguns lugares q eu consultei ter dificaultado e embolado tudo.Leiam os comentários em <span style="color: blue;">AZUL</span> e onde houver o item [PAGINAÇÃO] é um dado posto só por causa da paginação, pra separar o que é pra <span style="color: red;">BUSCA POR PALAVRA CHAVE</span> e o que é pra <span style="color: red;">PAGINAÇÃO</span>, pois esse post "mata dois coelhos numa só cajadada" e ainda com PDO.Separei em 3 arquivos:</b></p><p></p><p><blockquote class="tr_bq"><b>index.php</b></p><p><b>pesquisa.php</b></p><p><b>paginacao.php</b></blockquote></p><p><i><b>index.php</b></i></p><p>{% highlight bash %}&lt;!DOCTYPE html&gt;</p><p>&lt;html lang="pt-br"&gt;</p><p>&lt;head&gt;</p><p>&nbsp; &lt;meta charset="utf-8" /&gt;</p><p>&nbsp; &lt;title&gt;Buscar por palavras-chave com paginação em PDO&lt;/title&gt;</p><p>&nbsp; &lt;link rel="stylesheet" type="text/css" href="estilo" /&gt;</p><p>&lt;/head&gt;</p><p></p><p>&lt;body&gt;</p><p>&nbsp;&nbsp; &nbsp;&lt;div id="pesquisa"&gt;</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&lt;h4&gt;Digite o termo que deseja pesquisar&lt;/h4&gt;</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&lt;form action="" method="post" enctype="multipart/form-data"&gt;</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&lt;input type="text" name="palavra" class="palavra"/&gt;&lt;br /&gt;</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&lt;input type="radio" value="titulo" checked="checked" name="radio"/&gt;&lt;span&gt;pesquisar por Título&lt;/span&gt;&lt;br /&gt;</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&lt;input type="radio" value="noticia" name="radio" /&gt;&lt;span&gt;pesquisar por Texto&lt;/span&gt;&lt;br /&gt;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; </p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&lt;input type="submit" name="pesquisar" value="pesquisar" /&gt;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; </p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&lt;/form&gt;</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&lt;br /&gt;</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &lt;a href="&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;"&gt;&lt;button&gt;Atualizar Página&lt;/button&gt;&lt;/a&gt;</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &lt;a href="cadastrar.php"&gt;&lt;button&gt;Cadastrar Notícia&lt;/button&gt;&lt;/a&gt;</p><p>&nbsp;&nbsp; &nbsp;&lt;/div&gt;</p><p>&nbsp;&nbsp; &nbsp;&lt;?php require_once("pesquisa.php"); ?&gt;</p><p>&lt;/body&gt;</p><p>&lt;/html&gt;{% endhighlight %}</p><p><b><i>pesquisa.php</i></b></p><p>{% highlight bash %}&lt;?php </p><p>&nbsp; <span style="color: blue;">/* definimos o método das variaveis [PAGINAÇÃO] */</span></p><p>&nbsp; if(isset($_GET['palavra'])){</p><p>&nbsp; &nbsp;&nbsp; &nbsp;$palavra = $_GET['palavra'];</p><p>&nbsp;&nbsp; &nbsp;extract($_GET); </p><p>&nbsp; }elseif(isset($_POST['palavra'])){</p><p>&nbsp; &nbsp;&nbsp; &nbsp;$palavra = $_POST['palavra'];</p><p>&nbsp;&nbsp; &nbsp;extract($_POST);</p><p>&nbsp; }</p><p></p><p>&nbsp; <span style="color: blue;">/* se existir pesquisa e for diferente de branco, entramos nesse bloco */</span></p><p>&nbsp; if(isset($palavra) AND !empty($palavra)){</p><p></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue;">/* Conexão como banco com PDO */</span></p><p>&nbsp;&nbsp; &nbsp;&nbsp; $db = new PDO("mysql:host=localhost;dbname=paginacao","usuario","senha");</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue;">/* máximo de resultados por página [PAGINAÇÃO] */</span></p><p>&nbsp;&nbsp; &nbsp;&nbsp; $qtde&nbsp;&nbsp; = 2;</p><p>&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/* caso não exista a variavel GET, ela será 1 [PAGINAÇÃO] */</span></p><p>&nbsp;&nbsp; &nbsp;&nbsp; $pagina = (isset($_GET['pagina'])) ? (int)$_GET['pagina'] : 1;</p><p>&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/* definimos de onde começará a paginação [PAGINAÇÃO] */</span></p><p>&nbsp;&nbsp; &nbsp;&nbsp; $inicio = ($qtde * $pagina) - $qtde;</p><p>&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/* para evitar o erro de variavel indefinida, pois somaremos a ela */</span></p><p>&nbsp;&nbsp; &nbsp;&nbsp; $busca&nbsp; = "";</p><p>&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/* transforma num array, separando os espaços vazis */</span></p><p>&nbsp;&nbsp; &nbsp;&nbsp; $explode = explode(" ", $palavra);</p><p>&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/*conta os valores de um array */</span></p><p>&nbsp;&nbsp; &nbsp;&nbsp; $num = count($explode);</p><p>&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/* preparamos os valores para jogarmos no bindValue do PDO */</span></p><p>&nbsp;&nbsp; &nbsp;&nbsp; for ($i=0; $i &lt; $num; $i++) {</p><p>&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/* resultará em, ex.: titulo LIKE :busca1 OR titulo LIKE :busca2 ... */ </span></p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; $busca .= " `$radio` LIKE :busca$i ";</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; if($i&lt;&gt;$num -1){</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<span style="color: blue;">/* vc pode usar AND, depende de como quer sua pesquisa */</span></p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$busca .= " OR ";</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; }</p><p>&nbsp;&nbsp; &nbsp;&nbsp; }</p><p>&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/* preparando a consulta dos dados */</span></p><p>&nbsp;&nbsp; &nbsp;&nbsp; $sql = "SELECT * FROM `noticias` WHERE $busca ORDER BY `id` ASC LIMIT $inicio, $qtde";</p><p>&nbsp;&nbsp; &nbsp;&nbsp; $buscar = $db-&gt;prepare($sql);</p><p>&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/* separará o :busca$i pelas palavras chaves digitadas */</span></p><p>&nbsp;&nbsp; &nbsp;&nbsp; for ($i=0; $i &lt; $num; $i++) {</p><p>&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$buscar-&gt;bindValue(":busca$i",'%'.$explode[$i].'%',PDO::PARAM_STR);</p><p>&nbsp;&nbsp; &nbsp;&nbsp; }&nbsp;&nbsp; &nbsp; </p><p>&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/* como não foram passadas variaveis pro prepare, basta executar */</span></p><p>&nbsp;&nbsp; &nbsp;&nbsp; $buscar-&gt;execute();</p><p>&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/* se a consulta houver pelo menos 1 resultado, exibirá o título */</span></p><p>&nbsp;&nbsp; &nbsp;&nbsp; if($buscar-&gt;rowCount() &gt; 0){</p><p>&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;echo '&lt;div id="resultados"&gt;';</p><p>&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;echo "&lt;ul&gt;";</p><p>&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;while($res = $buscar-&gt;fetch(PDO::FETCH_ASSOC)){</p><p>&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;echo '&lt;li&gt;'.$res['titulo'].'&lt;/li&gt;';</p><p>&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;echo "&lt;/ul&gt;";&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; </p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;echo '&lt;/div&gt;';</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;echo '&lt;div id="paginacao"&gt;';</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<span style="color: blue;">/* incluímos a paginação [PAGINAÇÃO] */</span></p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;require_once('paginacao.php');&nbsp;&nbsp; </p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;echo '&lt;/div&gt;';&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; </p><p>&nbsp;&nbsp; &nbsp;&nbsp; }</p><p></p><p>&nbsp; }</p><p>?&gt;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; </p><p>&nbsp;&nbsp;&nbsp;{% endhighlight %}</p><p><b><i>paginacao.php</i></b></p><p>{% highlight bash %}&lt;?php</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue;">/* serve pra saber quantos resultados existirá para tal pesquisa */</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$sqlTotal = "SELECT * FROM `noticias` WHERE $busca";</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$pagTotal = $db-&gt;prepare($sqlTotal);&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; </p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; for ($i=0; $i &lt; $num; $i++) {</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$pagTotal-&gt;bindValue(":busca$i",'%'.$explode[$i].'%',PDO::PARAM_STR);</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; }&nbsp;&nbsp; &nbsp; </p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$pagTotal-&gt;execute();</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<span style="color: blue;">/* arqmaneza a quantidade de resultados, não usamos a outra consulta pra isso, </span><br style="color: blue;" /><span style="color: blue;"> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; * pois sempre será o informado pelo LIMIT */</span></p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$numTotal = $pagTotal-&gt;rowCount();</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<span style="color: blue;">/* arredondamos o total divido pela quantidade */</span></p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$totalPag = ceil($numTotal/$qtde);</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue;">/* agora basta exibir a paginação, se quiser ainda pode criar pagina inicial = 1,</span><br style="color: blue;" /><span style="color: blue;"> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; *&nbsp; e ultima pagina = total de paginas */</span></p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for($i=1;$i&lt;=$totalPag;$i++){</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if($i == $pagina)</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; echo $i;</p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;else </p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;echo " &lt;a href=\"?palavra=$palavra&amp;amp;radio=$radio&amp;amp;pagina=$i\"&gt;$i&lt;/a&gt; ";&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; </p><p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}</p><p>?&gt;{% endhighlight %}</p><p></p><p><b>Espero que gostem e comentem!</b>

</p>
