---
layout: post
title: Buscar por palavras-chave com paginação em PDO
date: '2011-12-26T16:56:00.000-08:00'
description: Buscar por palavras-chave com paginação em PDO
main-class: 'misc'
color: '#34a853'
author: The Bang Bash
tags:
- MySQL
- PHP
modified_time: '2013-05-03T07:16:08.696-07:00'
twitter_text: Buscar por palavras-chave com paginação em PDO
introduction: Buscar por palavras-chave com paginação em PDO
---

<b>Fala <strike>rapaziada</strike>, mais um post até antes do fim do ano, pretendo lançar no mínimo mais uns 4 hehe...hoje vou mostrar como buscar com palavras chaves, como o <span style="font-size: x-small;">Google, o Bing, o Yahoo, o DuckDuckGo</span> e outros <u>buscadores grandes fazem, e paginam</u>, e vamos fazer tudo isso sempre com <span style="color: blue;">PDO,</span> não é só porque curto o PDO, mas é a maneira correta, vai que depois você decide mudar o banco pra pra PostGreSQL, Oracle...não precisará mudar todos.</b><br /><b><br /></b><br /><b>Esse processo é bem simples, apesar de alguns lugares q eu consultei ter dificaultado e embolado tudo.Leiam os comentários em <span style="color: blue;">AZUL</span> e onde houver o item [PAGINAÇÃO] é um dado posto só por causa da paginação, pra separar o que é pra <span style="color: red;">BUSCA POR PALAVRA CHAVE</span> e o que é pra <span style="color: red;">PAGINAÇÃO</span>, pois esse post "mata dois coelhos numa só cajadada" e ainda com PDO.Separei em 3 arquivos:</b><br /><br /><blockquote class="tr_bq"><b>index.php</b><br /><b>pesquisa.php</b><br /><b>paginacao.php</b></blockquote><br /><i><b>index.php</b></i><br />{% highlight bash %}&lt;!DOCTYPE html&gt;<br />&lt;html lang="pt-br"&gt;<br />&lt;head&gt;<br />&nbsp; &lt;meta charset="utf-8" /&gt;<br />&nbsp; &lt;title&gt;Buscar por palavras-chave com paginação em PDO&lt;/title&gt;<br />&nbsp; &lt;link rel="stylesheet" type="text/css" href="estilo" /&gt;<br />&lt;/head&gt;<br /><br />&lt;body&gt;<br />&nbsp;&nbsp; &nbsp;&lt;div id="pesquisa"&gt;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&lt;h4&gt;Digite o termo que deseja pesquisar&lt;/h4&gt;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&lt;form action="" method="post" enctype="multipart/form-data"&gt;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&lt;input type="text" name="palavra" class="palavra"/&gt;&lt;br /&gt;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&lt;input type="radio" value="titulo" checked="checked" name="radio"/&gt;&lt;span&gt;pesquisar por Título&lt;/span&gt;&lt;br /&gt;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&lt;input type="radio" value="noticia" name="radio" /&gt;&lt;span&gt;pesquisar por Texto&lt;/span&gt;&lt;br /&gt;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&lt;input type="submit" name="pesquisar" value="pesquisar" /&gt;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&lt;/form&gt;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&lt;br /&gt;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &lt;a href="&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;"&gt;&lt;button&gt;Atualizar Página&lt;/button&gt;&lt;/a&gt;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &lt;a href="cadastrar.php"&gt;&lt;button&gt;Cadastrar Notícia&lt;/button&gt;&lt;/a&gt;<br />&nbsp;&nbsp; &nbsp;&lt;/div&gt;<br />&nbsp;&nbsp; &nbsp;&lt;?php require_once("pesquisa.php"); ?&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;{% endhighlight %}<br /><b><i>pesquisa.php</i></b><br />{% highlight bash %}&lt;?php <br />&nbsp; <span style="color: blue;">/* definimos o método das variaveis [PAGINAÇÃO] */</span><br />&nbsp; if(isset($_GET['palavra'])){<br />&nbsp; &nbsp;&nbsp; &nbsp;$palavra = $_GET['palavra'];<br />&nbsp;&nbsp; &nbsp;extract($_GET); <br />&nbsp; }elseif(isset($_POST['palavra'])){<br />&nbsp; &nbsp;&nbsp; &nbsp;$palavra = $_POST['palavra'];<br />&nbsp;&nbsp; &nbsp;extract($_POST);<br />&nbsp; }<br /><br />&nbsp; <span style="color: blue;">/* se existir pesquisa e for diferente de branco, entramos nesse bloco */</span><br />&nbsp; if(isset($palavra) AND !empty($palavra)){<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue;">/* Conexão como banco com PDO */</span><br />&nbsp;&nbsp; &nbsp;&nbsp; $db = new PDO("mysql:host=localhost;dbname=paginacao","usuario","senha");<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue;">/* máximo de resultados por página [PAGINAÇÃO] */</span><br />&nbsp;&nbsp; &nbsp;&nbsp; $qtde&nbsp;&nbsp; = 2;<br />&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/* caso não exista a variavel GET, ela será 1 [PAGINAÇÃO] */</span><br />&nbsp;&nbsp; &nbsp;&nbsp; $pagina = (isset($_GET['pagina'])) ? (int)$_GET['pagina'] : 1;<br />&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/* definimos de onde começará a paginação [PAGINAÇÃO] */</span><br />&nbsp;&nbsp; &nbsp;&nbsp; $inicio = ($qtde * $pagina) - $qtde;<br />&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/* para evitar o erro de variavel indefinida, pois somaremos a ela */</span><br />&nbsp;&nbsp; &nbsp;&nbsp; $busca&nbsp; = "";<br />&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/* transforma num array, separando os espaços vazis */</span><br />&nbsp;&nbsp; &nbsp;&nbsp; $explode = explode(" ", $palavra);<br />&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/*conta os valores de um array */</span><br />&nbsp;&nbsp; &nbsp;&nbsp; $num = count($explode);<br />&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/* preparamos os valores para jogarmos no bindValue do PDO */</span><br />&nbsp;&nbsp; &nbsp;&nbsp; for ($i=0; $i &lt; $num; $i++) {<br />&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/* resultará em, ex.: titulo LIKE :busca1 OR titulo LIKE :busca2 ... */ </span><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; $busca .= " `$radio` LIKE :busca$i ";<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; if($i&lt;&gt;$num -1){<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<span style="color: blue;">/* vc pode usar AND, depende de como quer sua pesquisa */</span><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$busca .= " OR ";<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; }<br />&nbsp;&nbsp; &nbsp;&nbsp; }<br />&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/* preparando a consulta dos dados */</span><br />&nbsp;&nbsp; &nbsp;&nbsp; $sql = "SELECT * FROM `noticias` WHERE $busca ORDER BY `id` ASC LIMIT $inicio, $qtde";<br />&nbsp;&nbsp; &nbsp;&nbsp; $buscar = $db-&gt;prepare($sql);<br />&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/* separará o :busca$i pelas palavras chaves digitadas */</span><br />&nbsp;&nbsp; &nbsp;&nbsp; for ($i=0; $i &lt; $num; $i++) {<br />&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$buscar-&gt;bindValue(":busca$i",'%'.$explode[$i].'%',PDO::PARAM_STR);<br />&nbsp;&nbsp; &nbsp;&nbsp; }&nbsp;&nbsp; &nbsp; <br />&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/* como não foram passadas variaveis pro prepare, basta executar */</span><br />&nbsp;&nbsp; &nbsp;&nbsp; $buscar-&gt;execute();<br />&nbsp;&nbsp; &nbsp;&nbsp; <span style="color: blue;">/* se a consulta houver pelo menos 1 resultado, exibirá o título */</span><br />&nbsp;&nbsp; &nbsp;&nbsp; if($buscar-&gt;rowCount() &gt; 0){<br />&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;echo '&lt;div id="resultados"&gt;';<br />&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;echo "&lt;ul&gt;";<br />&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;while($res = $buscar-&gt;fetch(PDO::FETCH_ASSOC)){<br />&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;echo '&lt;li&gt;'.$res['titulo'].'&lt;/li&gt;';<br />&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;echo "&lt;/ul&gt;";&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;echo '&lt;/div&gt;';<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;echo '&lt;div id="paginacao"&gt;';<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<span style="color: blue;">/* incluímos a paginação [PAGINAÇÃO] */</span><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;require_once('paginacao.php');&nbsp;&nbsp; <br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;echo '&lt;/div&gt;';&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp; &nbsp;&nbsp; }<br /><br />&nbsp; }<br />?&gt;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;{% endhighlight %}<br /><b><i>paginacao.php</i></b><br />{% highlight bash %}&lt;?php<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue;">/* serve pra saber quantos resultados existirá para tal pesquisa */</span><br />&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$sqlTotal = "SELECT * FROM `noticias` WHERE $busca";<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$pagTotal = $db-&gt;prepare($sqlTotal);&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; for ($i=0; $i &lt; $num; $i++) {<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$pagTotal-&gt;bindValue(":busca$i",'%'.$explode[$i].'%',PDO::PARAM_STR);<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; }&nbsp;&nbsp; &nbsp; <br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$pagTotal-&gt;execute();<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<span style="color: blue;">/* arqmaneza a quantidade de resultados, não usamos a outra consulta pra isso, </span><br style="color: blue;" /><span style="color: blue;"> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; * pois sempre será o informado pelo LIMIT */</span><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$numTotal = $pagTotal-&gt;rowCount();<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<span style="color: blue;">/* arredondamos o total divido pela quantidade */</span><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$totalPag = ceil($numTotal/$qtde);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue;">/* agora basta exibir a paginação, se quiser ainda pode criar pagina inicial = 1,</span><br style="color: blue;" /><span style="color: blue;"> &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; *&nbsp; e ultima pagina = total de paginas */</span><br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for($i=1;$i&lt;=$totalPag;$i++){<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if($i == $pagina)<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; echo $i;<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;else <br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;echo " &lt;a href=\"?palavra=$palavra&amp;amp;radio=$radio&amp;amp;pagina=$i\"&gt;$i&lt;/a&gt; ";&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; <br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br />?&gt;{% endhighlight %}<br /><br /><b>Espero que gostem e comentem!</b>