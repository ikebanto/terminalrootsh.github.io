---
layout: post
title: Tratamento de imagens com ImageMagick
date: '2015-03-17T18:18:00.000-07:00'
description: Tratamento de imagens com ImageMagick
main-class: 'linux'
color: '#3b5998'
author: Marcos Oliveira
tags:
- Linux
- Dicas
- Imagens
- Terminal
- Comandos
modified_time: '2015-10-14T18:13:51.806-07:00'
thumbnail: http://3.bp.blogspot.com/-ptAYJYF_SRQ/VWPJrsP1XcI/AAAAAAAABP8/qw2BN___Q7c/s72-c/Imagemagick-logo.png
twitter_text: Tratamento de imagens com ImageMagick
introduction: Tratamento de imagens com ImageMagick
---

<p>
<div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-ptAYJYF_SRQ/VWPJrsP1XcI/AAAAAAAABP8/qw2BN___Q7c/s1600/Imagemagick-logo.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-ptAYJYF_SRQ/VWPJrsP1XcI/AAAAAAAABP8/qw2BN___Q7c/s320/Imagemagick-logo.png" /></a></div></p><p></p><p><b>O <a href="http://www.imagemagick.org/">ImageMagick</a> √© uma  poderosa ferramenta em modo texto para tratar imagens em suas diversas  formas: converter, redimensionar, criar, editar, cortar, juntar, editar  cores e mais um bilh√£o de funcionalidades. De vez em quando eu me deparo  com algumas necessidades bem espec√≠ficas, como por exemplo:  redimensionar todas as fotos que eu tirei dos b√™bados da noite passada,  pra eu por em algum lugar sem ter que precisar dar upload de 3MB por  foto.</p><p> Este tutorial se torna ent√£o uma refer√™ncia para algumas das tarefas  que podemos fazer com imagens usando o ImageMagick. E al√©m disso, vou  sempre tentar expandir o conte√∫do quando for surgindo mais tarefas,  assim como eu fa√ßo na p√°gina de <a href="http://www.devin.com.br/comandos_linux/">Comandos Linux</a>.</p><p> </b></p><p><h2 id="Obtendo-a-ferramenta"><b>Obtendo a ferramenta</b></h2><b>Antes de mais nada, √© necess√°rio obter a ferramenta ImageMagick, que  consiste em v√°rios programas (comandos) separados, cada um com uma  fun√ß√£o (o bom e velho modo Unix de fazer as coisas). O site do  ImageMagick √© o seguinte:</p><p> </b></p><p><ul><b><li><a href="http://www.imagemagick.org/">http://www.imagemagick.org/</a></li></b></ul><b>Voc√™ pode pegar uma vers√£o em c√≥digo-fonte e compilar manualmente, o  que √© um pouco mais demorado de se instalar. Se voc√™ usa Windows, baixe  diretamente a vers√£o instal√°vel (bin√°ria) para Windows. Mesma coisa para  o caso do MacOS X.</p><p> Se voc√™ usa Linux, ent√£o o ImageMagick provavelmente j√° est√° incluso  em sua distribui√ß√£o. Neste caso, o nome do pacote √© geralmente <b><i>imagemagick</i></b> (Debian-like) e <b><i>ImageMagick</i></b> (RH-Like). Geralmente os comandos da ferramenta v√£o parar no <i>/usr/bin</i>.</p><p> Enquanto escrevo este tutorial, os seguintes comandos do ImageMagick est√£o dispon√≠veis:</p><p> <ul><li>animate ‚Äì Anima imagens e mostra na tela</li><li>compare ‚Äì Compara matematicamente e visualmente duas imagens</li><li>composite ‚Äì Adiciona uma imagem em cima da outra</li><li>conjure ‚Äì Interpretador de scripts em linguagem Magick (MSL)</li><li>convert ‚Äì Converte e altera imagens em diversos formatos e formas</li><li>display ‚Äì Mostra imagens ou sequ√™ncias de imagens na tela</li><li>identify ‚Äì Mostra informa√ß√µes e caracter√≠sticas de uma imagem</li><li>import ‚Äì Salva o conte√∫do da tela em um arquivo (famoso print-screen)</li><li>mogrify ‚Äì Mesma coisa que o convert, s√≥ que sobrescreve os arquivos que est√° trabalhando</li><li>montage ‚Äì Junta v√°rias imagens em uma s√≥</li><li>stream ‚Äì Extrai por√ß√µes e/ou pixels das imagens e salva em outro local</li></ul><i>(Quando no Windows, estes mesmos nomes est√£o dispon√≠veis, mas com a extens√£o .exe.)</i></p><p> <i>Observa√ß√£o pessoal do autor: Eu ainda me lembro que, sem saber na √©poca, o comando <b>import</b> foi um dos primeiros comandos de Linux que aprendi depois que iniciei o  servidor X pela primeira vez, em 1997, servindo justamente para fazer  uma captura de tela e mostrar pra todo mundo que eu estava usando Linux  (fvwm95).</i></p><p> <h2 id="Convertendo-e-Editando-imagens">Convertendo e Editando imagens</h2>Apesar dos v√°rios comandos dispon√≠veis, o que mais usaremos aqui √© o <b>convert</b>.</p><p> <h3 id="Convertendo-imagens-de-um-formato-para-outro">Convertendo imagens de um formato para outro</h3><ul><li>De JPEG para PNG:</li></ul><div><div><table ><tbody><tr><td class="code"><div><div class="line number1 index0 alt2">
{% highlight bash %}
$ convert imagem.jpg imagem.png
{% endhighlight %}
</div><div class="line number2 index1 alt1">
{% highlight bash %}
$ identify imagem.jpg imagem.png
{% endhighlight %}
</div><div class="line number3 index2 alt2">
{% highlight bash %}
imagem.jpg JPEG 256x256 256x256+0+0 DirectClass 8-bit 6.33594kb
{% endhighlight %}
</div><div class="line number4 index3 alt1">
{% highlight bash %}
imagem.png[1] PNG 256x256 256x256+0+0 DirectClass 8-bit 23.2344kb&lt;/pre&gt;
{% endhighlight %}
</div></div></td></tr></tbody></table></div></div>(O comando identify foi s√≥ para mostrar os tipos de imagem.)</p><p> Note tamb√©m que ele n√£o sobrescreve o arquivo anterior, e sim cria um  novo. Qualquer opera√ß√£o que iria sobrescrever o arquivo original tem  que ser executada com o comando <b>mogrify</b> ao inv√©s do <b>convert</b>. A n√£o ser que voc√™ tenha uma raz√£o bem espec√≠fica, eu n√£o recomendo fazer isto <img alt="üòâ" class="emoji" src="http://s.w.org/images/core/emoji/72x72/1f609.png" draggable="false" /></p><p> <ul><li>De PNG para GIF:</li></ul><div><div><table ><tbody><tr><td class="code"><div><div class="line number1 index0 alt2">
{% highlight bash %}
$ convert imagem.png imagem.gif
{% endhighlight %}
</div></div></td></tr></tbody></table></div></div>(Esteja ciente de que √†s vezes o GIF fica com pior qualidade que o PNG)</p><p> Ou seja, basta especificar sua extens√£o que o <b>convert</b> faz a convers√£o para o formato adequado.</p><p> <h3 id="Redimensionando-imagens">Redimensionando imagens</h3><ul><li>Reduzindo uma imagem para a <b>metade</b> do seu tamanho:</li></ul><div><div id="highlighter_651798"><table ><tbody><tr><td class="code"><div><div class="line number1 index0 alt2">
{% highlight bash %}
$ convert -resize 50% imagem.jpg metade_da_imagem.jpg
{% endhighlight %}
</div></div></td></tr></tbody></table></div></div>Redimensiona a <i>imagem.jpg</i> pela metade e salva no arquivo <i>metade_da_imagem.jpg</i>. O 50%, obviamente, pode ser substitu√≠do por outra porcentagem para diminuir/aumentar a imagem no aspecto relativo correto.</p><p> <ul><li>Reduzindo para um tamanho espec√≠fico:</li></ul><div><div id="highlighter_135674"><table ><tbody><tr><td class="code"><div><div class="line number1 index0 alt2">
{% highlight bash %}
$ convert -resize '800x600' foto.jpg destino.jpg
{% endhighlight %}
</div></div></td></tr></tbody></table></div></div>Redimensiona a <i>foto.jpg</i> para 800√ó600 (aumenta ou diminui) e salva em <i>destino.jpg</i>.</p><p> <ul><li>Redimensionando todas as imagens de um diret√≥rio:</li></ul>O <b>convert</b> aceita os <i>coringas</i> (wildcards) da shell, ou seja, o asterisco (*) pode representar tudo:</p><p> <div><div id="highlighter_619736"><table ><tbody><tr><td class="code"><div><div class="line number1 index0 alt2">
{% highlight bash %}
$ convert -resize 50% *.jpg
{% endhighlight %}
</div></div></td></tr></tbody></table></div></div>Ele vai converter todos os arquivos que terminam com <b>.jpg</b> do diret√≥rio atual e o resultado ele salva em outros arquivos com  termina√ß√£o -0, -1, -2, etc. Pode ficar um pouco confuso essa nomeclatura  no final das contas.</p><p> Ent√£o neste caso, √© melhor a gente usar o comando <b>mogrify</b> com a <b>op√ß√£o -path</b>, assim:</p><p> <div><div id="highlighter_727883"><table ><tbody><tr><td class="code"><div><div class="line number1 index0 alt2">
{% highlight bash %}
$ mkdir -p resultado
{% endhighlight %}
</div><div class="line number2 index1 alt1">
{% highlight bash %}
$ mogrify -path resultado -resize 50% *.jpg
{% endhighlight %}
</div></div></td></tr></tbody></table></div></div>Todos os arquivos que terminam com <b>.jpg</b> do diret√≥rio atual ser√£o redimensionados para 50% de seu tamanho e armazenados com o mesmo nome no diret√≥rio <b>resultado</b>. Uso isto bastante para reduzir as imagens que baixo de cameras digitais de alta qualidade. N√£o se esque√ßa do <b>-path</b>! Se voc√™ se esquecer, as imagens originais ser√£o <b>perdidas</b>!</p><p> Outro jeito de fazer o mesmo, agora utilizando o convert e shell-script:</p><p> <div><div id="highlighter_499430"><table ><tbody><tr><td class="code"><div><div class="line number1 index0 alt2">
{% highlight bash %}
$ mkdir -p resultado
{% endhighlight %}
</div><div class="line number2 index1 alt1">
{% highlight bash %}
$ for IMAGEM in *.jpg ; do convert -resize 50% $IMAGEM resultado/$IMAGEM ; done
{% endhighlight %}
</div></div></td></tr></tbody></table></div></div><h3 id="Mexendo-na-qualidade">Mexendo na qualidade</h3>Em alguns formatos como o .jpg, √© poss√≠vel mexer na <i>qualidade</i> da imagem, que impacta tamb√©m no tamanho da mesma. Exemplo:</p><p> <div><div id="highlighter_165629"><table ><tbody><tr><td class="code"><div><div class="line number1 index0 alt2">
{% highlight bash %}
$ convert -quality 80% imagem.jpg
{% endhighlight %}
</div></div></td></tr></tbody></table></div></div>Converte a qualidade da <i>imagem.jpg</i> para <i>80%</i>.</p><p> <h3 id="Rotacionando-imagens">Rotacionando imagens</h3>√â poss√≠vel rotacionar as imagens automaticamente, com o angulo  desejado. Por exemplo, vamos rotacionar nos angulos 90, 180 e 270 graus,  que correspondem a ‚Äúdeitar a imagem‚Äù e a vir√°-la de cabe√ßa pra baixo:</p><p> <div><div id="highlighter_357895"><table ><tbody><tr><td class="code"><div><div class="line number1 index0 alt2">
{% highlight bash %}
$ convert -rotate 90 foto.jpg foto90g.jpg
{% endhighlight %}
</div><div class="line number2 index1 alt1">
{% highlight bash %}
$ convert -rotate 180 foto.jpg foto180g.jpg
{% endhighlight %}
</div><div class="line number3 index2 alt2">
{% highlight bash %}
$ convert -rotate 270 foto.jpg foto270g.jpg
{% endhighlight %}
</div></div></td></tr></tbody></table></div></div>Resultados:</p><p> <a href="http://www.devin.com.br/wp-content/uploads/2009/07/foto_90g.jpg"><img alt="foto 90g Tratamento de imagens com ImageMagick" class="alignnone size-medium wp-image-883" src="http://www.devin.com.br/wp-content/uploads/2009/07/foto_90g.jpg" height="100" title="foto_90g" width="133" /></a> <a href="http://www.devin.com.br/wp-content/uploads/2009/07/foto_180g.jpg"><img alt="foto 180g Tratamento de imagens com ImageMagick" class="alignnone size-medium wp-image-884" src="http://www.devin.com.br/wp-content/uploads/2009/07/foto_180g.jpg" height="133" title="foto_180g" width="100" /></a> <a href="http://www.devin.com.br/wp-content/uploads/2009/07/foto_270g.jpg"><img alt="foto 270g Tratamento de imagens com ImageMagick" class="alignnone size-medium wp-image-885" src="http://www.devin.com.br/wp-content/uploads/2009/07/foto_270g.jpg" height="100" title="foto_270g" width="133" /></a></p><p> <h3 id="Criando-thumbnails">Criando thumbnails</h3>Quando queremos criar uma galeria de imagens em uma p√°gina, √© legal criar <i>thumbnails</i> (miniaturas) destas imagens, para o usu√°rio pr√©-visualizar, clicar e  ver o tamanho real. √â uma boa vis√£o geral de todas as imagens e ainda  economiza espa√ßo e banda na hora de visualizar.</p><p> <img alt="foto thumbnail Tratamento de imagens com ImageMagick" class="alignright size-full wp-image-877" src="http://www.devin.com.br/wp-content/uploads/2009/07/foto_thumbnail.jpg" height="133" title="foto_thumbnail" width="100" />A melhor forma de se criar thumbnails, √© utilizar a op√ß√£o <b>-thumbnail</b> ao inv√©s do -resize. Eles fazem praticamente a mesma coisa, mas a op√ß√£o  -thumbnail tamb√©m remove informa√ß√µes dentro da imagem que n√£o s√£o √∫teis  em thumbnails.</p><p> <div><div id="highlighter_397689"><table ><tbody><tr><td class="code"><div><div class="line number1 index0 alt2">
{% highlight bash %}
$ mkdir -p thumbnails
{% endhighlight %}
</div><div class="line number2 index1 alt1">
{% highlight bash %}
$ mogrify -path thumbnails -thumbnail '100x150' *.jpg
{% endhighlight %}
</div></div></td></tr></tbody></table></div></div>Todas as imagens com extens√£o <b>.jpg</b> ser√£o  redimensionadas para 100√ó150 pixels e jogadas em um diret√≥rio chamado  thumbnails, com o mesmo nome. Mais uma vez, n√£o se esque√ßa da op√ß√£o <b>-path</b> ou voc√™ pode perder todas as imagens originais.</p><p> Agora gerando thumbnails com <b>apenas a largura fixa</b>, isso significa que a altura pode variar de acordo com a foto.</p><p> <div><div id="highlighter_527921"><table ><tbody><tr><td class="code"><div><div class="line number1 index0 alt2">
{% highlight bash %}
$ mkdir -p thumbnails
{% endhighlight %}
</div><div class="line number2 index1 alt1">
{% highlight bash %}
$ mogrify -path thumbnails -thumbnail '100x150&gt;' *.jpg
{% endhighlight %}
</div></div></td></tr></tbody></table></div></div>Se voc√™ est√° fazendo isso com fotos que vem de cameras digitais,  dentro da imagem geralmente tem uma informa√ß√£o se a imagem deve ser  rotacionada caso voc√™ tenha tirado a foto com a c√¢mera <i>em p√©.</i> Neste caso, a op√ß√£o <b>-auto-orient</b> se torna bastante √∫til pois rotaciona pra voc√™:</p><p> <div><div id="highlighter_926303"><table ><tbody><tr><td class="code"><div><div class="line number1 index0 alt2">
{% highlight bash %}
$ mkdir -p thumbnails
{% endhighlight %}
</div><div class="line number2 index1 alt1">
{% highlight bash %}
$ mogrify -path thumbnails -thumbnail '100x150&gt;' -auto-orient *.jpg
{% endhighlight %}
</div></div></td></tr></tbody></table></div></div><img alt="foto thumbnailpolarid Tratamento de imagens com ImageMagick" class="alignright size-full wp-image-879" src="http://www.devin.com.br/wp-content/uploads/2009/07/foto_thumbnailpolarid.png" height="173" title="foto_thumbnailpolarid" width="144" />Um  √∫ltimo exemplo de gera√ß√£o de thumbnail, que peguei na documenta√ß√£o do  ImageMagick, √© criar uma ‚Äúborda‚Äù no estilo foto polaroid:</p><p> <div><div id="highlighter_688715"><table ><tbody><tr><td class="code"><div><div class="line number1 index0 alt2">
{% highlight bash %}
$ convert -thumbnail '100x150&gt;' -bordercolor snow -background black \
{% endhighlight %}
</div><div class="line number2 index1 alt1">


{% highlight bash %}
+polaroid foto.jpg foto_thumbnailpolarid.png
{% endhighlight %}
</div></div></td></tr></tbody></table></div></div>Observe que ele girou um pouco a imagem, colocou um efeito ‚Äútipo papel‚Äù e ainda converteu para .png com transpar√™ncia.</p><p> Tamb√©m tem outras t√©nicas bem interessantes:</p><p> <div><div id="highlighter_463230"><table ><tbody><tr><td class="code"><div><div class="line number1 index0 alt2">
{% highlight bash %}
$ convert -thumbnail '100x150&gt;' -matte -background none \
{% endhighlight %}
</div><div class="line number2 index1 alt1">

{% highlight bash %}
-vignette 0x4 foto.jpg foto_thumbnail2.png
{% endhighlight %}
</div></div></td></tr></tbody></table></div></div><div><div id="highlighter_784609"><table ><tbody><tr><td class="code"><div><div class="line number1 index0 alt2">
{% highlight bash %}
$ convert -thumbnail '100x150&gt;' -matte -virtual-pixel transparent \
{% endhighlight %}
</div><div class="line number2 index1 alt1">



{% highlight bash %}
-channel A -blur 0x8&nbsp; -level 0,50% +channel foto.jpg thumbnail_softedge.png
{% endhighlight %}
</div></div></td></tr></tbody></table></div></div><a href="http://www.devin.com.br/wp-content/uploads/2009/07/foto_thumbnail2.png"><img alt="foto thumbnail2 Tratamento de imagens com ImageMagick" class="alignnone size-medium wp-image-880" src="http://www.devin.com.br/wp-content/uploads/2009/07/foto_thumbnail2.png" height="133" title="foto_thumbnail2" width="100" /></a> <a href="http://www.devin.com.br/wp-content/uploads/2009/07/foto_thumbnailsoftedge.png"><img alt="foto thumbnailsoftedge Tratamento de imagens com ImageMagick" class="alignnone size-medium wp-image-881" src="http://www.devin.com.br/wp-content/uploads/2009/07/foto_thumbnailsoftedge.png" height="133" title="foto_thumbnailsoftedge" width="100" /></a></p><p> Estes efeitos tamb√©m podem ser aplicados n√£o apenas paraos thumbnails, mas para as imagens originais tamb√©m. Basta remover o <b>-thumbnail</b>.</p><p> Diversos exemplos a mais de como criar thumbnails, voc√™ encontra na p√°gina oficial:</p><p> <ul><li><a href="http://www.imagemagick.org/Usage/thumbnails/">http://www.imagemagick.org/Usage/thumbnails/</a></li></ul><h2 id="Extendendo-o-uso-do-ImageMagick-em-outras-aplicaes">Extendendo o uso do ImageMagick em outras aplica√ß√µes</h2>Al√©m de todos estes comandos e a√ß√µes que o ImageMagick proporciona,  ele tamb√©m pode ser aplicado diretamente em outros programas, em  diversas linguagens de programa√ß√£o, atrav√©s de sua <i>API</i>. No momento que eu escrevo este tutorial, a API est√° dispon√≠vel para as seguintes linguagens/m√©todos/toolkits:</p><p> Ada, C, Ch, COM+, C++, Java, LabVIEW, Lisp, Neko, .NET, Pascal, Perl, PHP, Python, Ruby, Tcl/TK, XML-RPC.</p><p> Para mais informa√ß√µes consulte a p√°gina de API do ImageMagick:</p><p> <ul><li><a href="http://www.imagemagick.org/script/api.php">http://www.imagemagick.org/script/api.php</a></li></ul><h2 id="Referncias">Refer√™ncias</h2>Grande parte deste artigo foi aprendido (al√©m das p√°ginas de manual)  atrav√©s da p√°gina oficial de documenta√ß√£o do ImageMagick, que √© muito,  muito, muito completa. O endere√ßo √©:</p><p> <ul><li><a href="http://www.imagemagick.org/Usage/">http://www.imagemagick.org/Usage/</a></li></ul>Considero este tutorial ent√£o, uma vers√£o t√≠mida e em portugu√™s do uso do ImageMagick <img alt="üòâ" class="emoji" src="http://s.w.org/images/core/emoji/72x72/1f609.png" draggable="false" /></p><p></b>Via: http://www.devin.com.br/imagemagick/


</p>
