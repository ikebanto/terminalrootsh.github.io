---
layout: post
title: 'Curso Certificação Linux LPI-102: Servidor Postfix'
date: '2013-04-01T16:08:00.000-07:00'
description: 'Curso Certificação Linux LPI-102: Servidor Postfix'
main-class: 'linux'
color: '#3b5998'
author: The Bang Bash
tags:
- Linux
- LPI
modified_time: '2013-05-03T07:16:04.310-07:00'
thumbnail: http://2.bp.blogspot.com/-cGPNLef_KXE/TwRli2xcVxI/AAAAAAAAAUo/g3sOziSO9Ds/s72-c/InternetSite.png
twitter_text: 'Curso Certificação Linux LPI-102: Servidor Postfix'
introduction: 'Curso Certificação Linux LPI-102: Servidor Postfix'
---

<p>
<!-------------------------------------------------></p><p></p><p><script type="text/javascript"><!-- google_ad_client = "ca-pub-5528601613414387"; google_ad_host = "pub-1556223355139109"; /* quadrados */ google_ad_slot = "9713010559"; google_ad_width = 200; google_ad_height = 200; </script><script src="http://pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript"></script><!-----------------------------------------------></p><p></p><p><b>O <span style="color: blue;">Postfix</span> é um agente de transferência de emails (MTA), um software livre para envio e entrega de emails. Rápido e fácil de administrar, é uma alternativa segura ao Sendmail, muito utilizado em servidores UNIX.</b></p><p><b></p><p></b></p><p><b>Ele é uma espécie de meio termo entre a simplicidade do Qmail e a fartura de recursos do Exim. Entre os três, ele é o mais rápido e o mais simples de configurar, o que faz com que ele seja atualmente o mais popular e o que possui mais documentação disponível. O Postfix também possui um excelente histórico de segurança, sendo considerado por muitos tão seguro quanto o Qmail.</b></p><p><b></p><p></b></p><p><b>Existem fortes motivos para não usar o Sendmail ou o Qmail em novas instalações, mas temos uma boa briga entre o Postfix e o Exim. Escolhi abordar o Postfix aqui simplesmente por que, entre os dois, ele é mais popular, o que torna mais simples encontrar documentação e conseguir ajuda quando tiver dúvidas.</b></p><p><b></p><p></b></p><p><b>Instalando o Postfix</b></p><p><b>{% highlight bash %}$ su</p><p># apt-get install postfix{% endhighlight %}, durante a Instalação ele deverá perguntar: Qual o tipo geral de configuração, marque o item Internet Site</b></p><p><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-cGPNLef_KXE/TwRli2xcVxI/AAAAAAAAAUo/g3sOziSO9Ds/s1600/InternetSite.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-cGPNLef_KXE/TwRli2xcVxI/AAAAAAAAAUo/g3sOziSO9Ds/s320/InternetSite.png" height="202" width="320" /></a></div><b>&nbsp;e o nome/endereço do Servidor, digite o nome que você deseja:</b></p><p><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-HYxBeYkMNzU/TwRl8DQu1SI/AAAAAAAAAU0/v7ZueSxZ25M/s1600/marcospinguim.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-HYxBeYkMNzU/TwRl8DQu1SI/AAAAAAAAAU0/v7ZueSxZ25M/s320/marcospinguim.png" height="205" width="320" /></a></div><b>&nbsp;, para as demais perguntas, deixe as opções defaults como já vêm pré-marcadas.</b></p><p><b></p><p></b></p><p><b>Obs.:Na pergunta: força atualizações síncronas na fila de email ? Marque como não:</b></p><p><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-3-A5g_TScFQ/TwRmA5f72mI/AAAAAAAAAVA/ueFVxyB3JHo/s1600/marcar_nao.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-3-A5g_TScFQ/TwRmA5f72mI/AAAAAAAAAVA/ueFVxyB3JHo/s320/marcar_nao.png" height="204" width="320" /></a></div><b></p><p></b></p><p><b></p><p></b></p><p><b>Configuração Inicial</b></p><p><b></p><p></b></p><p><b>Edite o arquivo {% highlight bash %}# vi /etc/postfix/main.cf{% endhighlight %} e inclua as configurações abaixo:</b></p><p><b>{% highlight bash %}mydomain = marcospinguim.com.br</p><p>myhostname = host.$mydomain</p><p>myorigin = $mydomain</p><p>mydestination = $myhostname, $mydomain</p><p>mynetworks = 127.0.0.0/8 192.168.1.1/24</p><p>home_mailbox = Maildir/{% endhighlight %}</b></p><p><b></p><p></b></p><p><blockquote><b>mydomain: <i>O nome do domínio do servidor de e-mail.</i></b></p><p><b>myhostname: <i>O nome da máquina do servidor de e-mail.</i></b></p><p><b>myorigin: <i>Especifica como ficará a terminação do e-mail após o @.</i></b></p><p><b>mydestination: <i>Os nomes dos domínios que o servidor de e-mail é responsável.</i></b></p><p><b>mynetworks: <i>Especifica a qual rede que o servidor de e-mail irá trabalhar.</i></b></p><p><b>home_mailbox: <i>Especifica o diretório onde ficará as mensagens de e-mail.</i></b></blockquote><b></p><p></b></p><p><b>Após isso recarregue as informações no Postfix:</b></p><p><b>{% highlight bash %}# /etc/init.d/postfix reload{% endhighlight %}</b></p><p><b></p><p></b></p><p><b></p><p></b></p><p><b></p><p></b></p><p><b>Testando o Envio de E-mails:</b></p><p><b></p><p></b></p><p><b>No meu PC existe um usuario com o nome [marcos] e outro com o nome [eric], teste com os usuarios da sua máquina, se não houver crie-os com <i>useradd</i>, neste exemplo abaixo o usuário [marcos] enviou um e-mail para o usuário [eric], lógico que estou logado como root, mas usei o comando [MAIL from:] e especifiquei o usuário que envia o e-mail, para critério de teste.</b></p><p><b></p><p></b></p><p><b>Destaquei os comandos que vc deve executar para isso em VERMELHO:</b></p><p><b></p><p></b></p><p><b>{% highlight bash %}# <span style="color: red;">telnet localhost 25</span></p><p>Trying ::1...</p><p>Trying 127.0.0.1...</p><p>Connected to localhost.</p><p>Escape character is '^]'.</p><p>220 host.marcospinguim.com.br ESMTP Postfix (Ubuntu)</p><p><span style="color: red;">HELO smtp.marcospinguim.com.br</span></p><p>250 host.marcospinguim.com.br</p><p><span style="color: red;">MAIL from: marcos</span></p><p>250 2.1.0 Ok</p><p><span style="color: red;">RCPT to: eric</span></p><p>250 2.1.5 Ok</p><p><span style="color: red;">DATA</span></p><p>354 End data with <cr><lf>.<cr><lf></p><p><span style="color: red;">Este post sobre Postfix no blog é loucooooo!</span></p><p><span style="color: red;">.</span></p><p>250 2.0.0 Ok: queued as A8F958F5DE</p><p><span style="color: red;">QUIT</span></p><p>221 2.0.0 Bye</p><p>Connection closed by foreign host.</lf></cr></lf></cr>{% endhighlight %}</b></p><p><b></p><p></b></p><p><b>Instalar o pacote SASL</b></p><p><b></p><p></b></p><p><b>Este recurso é importante hoje em dia, pois sem encriptação, seus e-mails (incluindo o login e senha) são transmitidos em texto plano pela rede e podem ser Sniffados. Uma vez ativo o recurso no servidor, basta marcar a opção no cliente de e-mails.</b></p><p><b></p><p></b></p><p><b>{% highlight bash %}apt-get install sasl2-bin{% endhighlight %} , agora abra novamente o arquivo main.cf e inclua as linhas abaixo nele:</b></p><p><b>{% highlight bash %}smtpd_sasl_auth_enable = yes</p><p>broken_sasl_auth_clients = yes</p><p>smtpd_sasl_authenticated_header = yes</p><p>smtpd_helo_required = yes</p><p>smtpd_recipient_restrictions = </p><p>permit_mynetworks,</p><p>permit_sasl_authenticated,</p><p>reject_unauth_destination{% endhighlight %}</b></p><p><b></p><p></b></p><p><b>Depois ative ele abrindo o arquivo de configuração:</b></p><p><b>{% highlight bash %}# vi /etc/default/saslauthd{% endhighlight %} e inclua o código abaixo no arquivo, na verdade essa linhas já existirão, mas você deve alterá-las para ficar assim:</b></p><p><b>Obs.:As linhas não estão uma abaixo da outra, procure-as e altere:</b></p><p><b>{% highlight bash %}START=yes</p><p>OPTIONS="-c -m /var/spool/postfix/var/run/saslauthd -r"{% endhighlight %}, salve e feche o arquivo. Agora rode esse comando no terminal para verificar se o usuário postfix existe:{% highlight bash %}# groups postfix{% endhighlight %} , se retornar postfix : postfix , rode esse comando:{% highlight bash %}# usermod -G sasl postfix{% endhighlight %}, se verificar novamente com o comando groups postfix, agora retornará postfix : postfix sasl , caso não ocorra, dê um reload no postfix (/etc/init.d/postfix reload).</b></p><p><b></p><p></b></p><p><b>Crie o arquivo smtpd.conf no diretório "/etc/postfix/sasl" e adicione as seguintes linhas abaixo:</b></p><p><b>{% highlight bash %}pwcheck_method: saslauthd</p><p>mech_list: plain login{% endhighlight %}</b></p><p><b></p><p></b></p><p><b>Terminado as configurações, reinicie o Postfix e o serviço de autenticação:</b></p><p><b></p><p></b></p><p><b>{% highlight bash %}# /etc/init.d/postfix restart</p><p># /etc/init.d/saslauthd restart{% endhighlight %}</b></p><p><b></p><p></b></p><p><b>Você pode ainda implementar uma criptogrfia TLS e criar o certificado, dá uma pesquisada na Internet. </b></p><p><b></p><p></b></p><p><b>Lendo os e-mails</b></p><p><b></p><p></b></p><p><b>Para poder ler as mensagens de e-mail recebidas, será usado o Servidor POP3:</b></p><p><b></p><p></b></p><p><b>{% highlight bash %}# apt-get install courier-pop-ssl{% endhighlight %}</b></p><p><b></p><p></b></p><p><b>Testando o Servidor POP3</b></p><p><b></p><p></b></p><p><b>Para verificar se o Servidor POP3 está funcionando, use o Telnet para ler as mensagens de e-mail recebidas:lembra que o [marcos] enviou mensagem para o usuário [eric] ? Agora o [eric] irá ler. Verifique os trechos em VERMELHO que são comandos para verificar os emails</b></p><p><b></p><p></b></p><p><b>{% highlight bash %}# <span style="color: red;">telnet localhost 110</span></p><p>Trying ::1...</p><p>Connected to localhost.</p><p>Escape character is '^]'.</p><p>+OK Hello there.</p><p><span style="color: red;">USER eric</span></p><p>+OK Password required.</p><p><span style="color: red;">PASS informe_aqui_a_senha</span></p><p>+OK logged in.</p><p><span style="color: red;">LIST</span></p><p>+OK POP3 clients that break here, they violate STD53.</p><p>1 517</p><p>.</p><p><span style="color: red;">RETR 1</span></p><p>+OK 517 octets follow.</p><p>Return-Path: <marcos marcospinguim.com.br=""></p><p>X-Original-To: eric</p><p>Delivered-To: eric@marcospinguim.com.br</p><p>Received: from smtp.marcospinguim.com.br (localhost [127.0.0.1])</p><p>by host.marcospinguim.com.br (Postfix) with SMTP id A8F958F5DE</p><p>for <eric>; Wed,  4 Jan 2012 12:01:31 -0200 (BRST)</p><p>Message-Id: &lt;20120104140146.A8F958F5DE@host.marcospinguim.com.br&gt;</p><p>Date: Wed,  4 Jan 2012 12:01:31 -0200 (BRST)</p><p>From: marcos@marcospinguim.com.br</p><p>To: undisclosed-recipients:;</p><p></p><p>Este post sobre Postfix no blog é loucooooo!</p><p>.</p><p><span style="color: red;">QUIT</span></p><p>+OK Bye-bye.</p><p>Connection closed by foreign host.</eric></marcos>{% endhighlight %}</b></p><p><b></p><p></b></p><p></p><p><blockquote><b> Obs.: Percebam que as mensagem são arquivos e ficam nas pasta <i>Maildir/cur</i> dos usuários (<i>/home/usuario/Maildir/cu</i>r).<b></b></b></blockquote></p><p><b>Pronto, espero que gostem e comentem!</b>

</p>
