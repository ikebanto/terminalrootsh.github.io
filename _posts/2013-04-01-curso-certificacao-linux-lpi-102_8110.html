---
layout: post
title: 'Curso Certificação Linux LPI-102: Servidor Postfix'
date: '2013-04-01T16:08:00.000-07:00'
description: 'Curso Certificação Linux LPI-102: Servidor Postfix'
main-class: 'linux'
color: '#3b5998'
author: The Bang Bash
tags:
- Linux
- LPI
modified_time: '2013-05-03T07:16:04.310-07:00'
thumbnail: http://2.bp.blogspot.com/-cGPNLef_KXE/TwRli2xcVxI/AAAAAAAAAUo/g3sOziSO9Ds/s72-c/InternetSite.png
twitter_text: 'Curso Certificação Linux LPI-102: Servidor Postfix'
introduction: 'Curso Certificação Linux LPI-102: Servidor Postfix'
---

<!-------------------------------------------------><br /><br /><script type="text/javascript"><!-- google_ad_client = "ca-pub-5528601613414387"; google_ad_host = "pub-1556223355139109"; /* quadrados */ google_ad_slot = "9713010559"; google_ad_width = 200; google_ad_height = 200; </script><script src="http://pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript"></script><!-----------------------------------------------><br /><br /><b>O <span style="color: blue;">Postfix</span> é um agente de transferência de emails (MTA), um software livre para envio e entrega de emails. Rápido e fácil de administrar, é uma alternativa segura ao Sendmail, muito utilizado em servidores UNIX.</b><br /><b><br /></b><br /><b>Ele é uma espécie de meio termo entre a simplicidade do Qmail e a fartura de recursos do Exim. Entre os três, ele é o mais rápido e o mais simples de configurar, o que faz com que ele seja atualmente o mais popular e o que possui mais documentação disponível. O Postfix também possui um excelente histórico de segurança, sendo considerado por muitos tão seguro quanto o Qmail.</b><br /><b><br /></b><br /><b>Existem fortes motivos para não usar o Sendmail ou o Qmail em novas instalações, mas temos uma boa briga entre o Postfix e o Exim. Escolhi abordar o Postfix aqui simplesmente por que, entre os dois, ele é mais popular, o que torna mais simples encontrar documentação e conseguir ajuda quando tiver dúvidas.</b><br /><b><br /></b><br /><b>Instalando o Postfix</b><br /><b>{% highlight bash %}$ su<br /># apt-get install postfix{% endhighlight %}, durante a Instalação ele deverá perguntar: Qual o tipo geral de configuração, marque o item Internet Site</b><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-cGPNLef_KXE/TwRli2xcVxI/AAAAAAAAAUo/g3sOziSO9Ds/s1600/InternetSite.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-cGPNLef_KXE/TwRli2xcVxI/AAAAAAAAAUo/g3sOziSO9Ds/s320/InternetSite.png" height="202" width="320" /></a></div><b>&nbsp;e o nome/endereço do Servidor, digite o nome que você deseja:</b><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-HYxBeYkMNzU/TwRl8DQu1SI/AAAAAAAAAU0/v7ZueSxZ25M/s1600/marcospinguim.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-HYxBeYkMNzU/TwRl8DQu1SI/AAAAAAAAAU0/v7ZueSxZ25M/s320/marcospinguim.png" height="205" width="320" /></a></div><b>&nbsp;, para as demais perguntas, deixe as opções defaults como já vêm pré-marcadas.</b><br /><b><br /></b><br /><b>Obs.:Na pergunta: força atualizações síncronas na fila de email ? Marque como não:</b><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-3-A5g_TScFQ/TwRmA5f72mI/AAAAAAAAAVA/ueFVxyB3JHo/s1600/marcar_nao.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-3-A5g_TScFQ/TwRmA5f72mI/AAAAAAAAAVA/ueFVxyB3JHo/s320/marcar_nao.png" height="204" width="320" /></a></div><b><br /></b><br /><b><br /></b><br /><b>Configuração Inicial</b><br /><b><br /></b><br /><b>Edite o arquivo {% highlight bash %}# vi /etc/postfix/main.cf{% endhighlight %} e inclua as configurações abaixo:</b><br /><b>{% highlight bash %}mydomain = marcospinguim.com.br<br />myhostname = host.$mydomain<br />myorigin = $mydomain<br />mydestination = $myhostname, $mydomain<br />mynetworks = 127.0.0.0/8 192.168.1.1/24<br />home_mailbox = Maildir/{% endhighlight %}</b><br /><b><br /></b><br /><blockquote><b>mydomain: <i>O nome do domínio do servidor de e-mail.</i></b><br /><b>myhostname: <i>O nome da máquina do servidor de e-mail.</i></b><br /><b>myorigin: <i>Especifica como ficará a terminação do e-mail após o @.</i></b><br /><b>mydestination: <i>Os nomes dos domínios que o servidor de e-mail é responsável.</i></b><br /><b>mynetworks: <i>Especifica a qual rede que o servidor de e-mail irá trabalhar.</i></b><br /><b>home_mailbox: <i>Especifica o diretório onde ficará as mensagens de e-mail.</i></b></blockquote><b><br /></b><br /><b>Após isso recarregue as informações no Postfix:</b><br /><b>{% highlight bash %}# /etc/init.d/postfix reload{% endhighlight %}</b><br /><b><br /></b><br /><b><br /></b><br /><b><br /></b><br /><b>Testando o Envio de E-mails:</b><br /><b><br /></b><br /><b>No meu PC existe um usuario com o nome [marcos] e outro com o nome [eric], teste com os usuarios da sua máquina, se não houver crie-os com <i>useradd</i>, neste exemplo abaixo o usuário [marcos] enviou um e-mail para o usuário [eric], lógico que estou logado como root, mas usei o comando [MAIL from:] e especifiquei o usuário que envia o e-mail, para critério de teste.</b><br /><b><br /></b><br /><b>Destaquei os comandos que vc deve executar para isso em VERMELHO:</b><br /><b><br /></b><br /><b>{% highlight bash %}# <span style="color: red;">telnet localhost 25</span><br />Trying ::1...<br />Trying 127.0.0.1...<br />Connected to localhost.<br />Escape character is '^]'.<br />220 host.marcospinguim.com.br ESMTP Postfix (Ubuntu)<br /><span style="color: red;">HELO smtp.marcospinguim.com.br</span><br />250 host.marcospinguim.com.br<br /><span style="color: red;">MAIL from: marcos</span><br />250 2.1.0 Ok<br /><span style="color: red;">RCPT to: eric</span><br />250 2.1.5 Ok<br /><span style="color: red;">DATA</span><br />354 End data with <cr><lf>.<cr><lf><br /><span style="color: red;">Este post sobre Postfix no blog é loucooooo!</span><br /><span style="color: red;">.</span><br />250 2.0.0 Ok: queued as A8F958F5DE<br /><span style="color: red;">QUIT</span><br />221 2.0.0 Bye<br />Connection closed by foreign host.</lf></cr></lf></cr>{% endhighlight %}</b><br /><b><br /></b><br /><b>Instalar o pacote SASL</b><br /><b><br /></b><br /><b>Este recurso é importante hoje em dia, pois sem encriptação, seus e-mails (incluindo o login e senha) são transmitidos em texto plano pela rede e podem ser Sniffados. Uma vez ativo o recurso no servidor, basta marcar a opção no cliente de e-mails.</b><br /><b><br /></b><br /><b>{% highlight bash %}apt-get install sasl2-bin{% endhighlight %} , agora abra novamente o arquivo main.cf e inclua as linhas abaixo nele:</b><br /><b>{% highlight bash %}smtpd_sasl_auth_enable = yes<br />broken_sasl_auth_clients = yes<br />smtpd_sasl_authenticated_header = yes<br />smtpd_helo_required = yes<br />smtpd_recipient_restrictions = <br />permit_mynetworks,<br />permit_sasl_authenticated,<br />reject_unauth_destination{% endhighlight %}</b><br /><b><br /></b><br /><b>Depois ative ele abrindo o arquivo de configuração:</b><br /><b>{% highlight bash %}# vi /etc/default/saslauthd{% endhighlight %} e inclua o código abaixo no arquivo, na verdade essa linhas já existirão, mas você deve alterá-las para ficar assim:</b><br /><b>Obs.:As linhas não estão uma abaixo da outra, procure-as e altere:</b><br /><b>{% highlight bash %}START=yes<br />OPTIONS="-c -m /var/spool/postfix/var/run/saslauthd -r"{% endhighlight %}, salve e feche o arquivo. Agora rode esse comando no terminal para verificar se o usuário postfix existe:{% highlight bash %}# groups postfix{% endhighlight %} , se retornar postfix : postfix , rode esse comando:{% highlight bash %}# usermod -G sasl postfix{% endhighlight %}, se verificar novamente com o comando groups postfix, agora retornará postfix : postfix sasl , caso não ocorra, dê um reload no postfix (/etc/init.d/postfix reload).</b><br /><b><br /></b><br /><b>Crie o arquivo smtpd.conf no diretório "/etc/postfix/sasl" e adicione as seguintes linhas abaixo:</b><br /><b>{% highlight bash %}pwcheck_method: saslauthd<br />mech_list: plain login{% endhighlight %}</b><br /><b><br /></b><br /><b>Terminado as configurações, reinicie o Postfix e o serviço de autenticação:</b><br /><b><br /></b><br /><b>{% highlight bash %}# /etc/init.d/postfix restart<br /># /etc/init.d/saslauthd restart{% endhighlight %}</b><br /><b><br /></b><br /><b>Você pode ainda implementar uma criptogrfia TLS e criar o certificado, dá uma pesquisada na Internet. </b><br /><b><br /></b><br /><b>Lendo os e-mails</b><br /><b><br /></b><br /><b>Para poder ler as mensagens de e-mail recebidas, será usado o Servidor POP3:</b><br /><b><br /></b><br /><b>{% highlight bash %}# apt-get install courier-pop-ssl{% endhighlight %}</b><br /><b><br /></b><br /><b>Testando o Servidor POP3</b><br /><b><br /></b><br /><b>Para verificar se o Servidor POP3 está funcionando, use o Telnet para ler as mensagens de e-mail recebidas:lembra que o [marcos] enviou mensagem para o usuário [eric] ? Agora o [eric] irá ler. Verifique os trechos em VERMELHO que são comandos para verificar os emails</b><br /><b><br /></b><br /><b>{% highlight bash %}# <span style="color: red;">telnet localhost 110</span><br />Trying ::1...<br />Connected to localhost.<br />Escape character is '^]'.<br />+OK Hello there.<br /><span style="color: red;">USER eric</span><br />+OK Password required.<br /><span style="color: red;">PASS informe_aqui_a_senha</span><br />+OK logged in.<br /><span style="color: red;">LIST</span><br />+OK POP3 clients that break here, they violate STD53.<br />1 517<br />.<br /><span style="color: red;">RETR 1</span><br />+OK 517 octets follow.<br />Return-Path: <marcos marcospinguim.com.br=""><br />X-Original-To: eric<br />Delivered-To: eric@marcospinguim.com.br<br />Received: from smtp.marcospinguim.com.br (localhost [127.0.0.1])<br />by host.marcospinguim.com.br (Postfix) with SMTP id A8F958F5DE<br />for <eric>; Wed,  4 Jan 2012 12:01:31 -0200 (BRST)<br />Message-Id: &lt;20120104140146.A8F958F5DE@host.marcospinguim.com.br&gt;<br />Date: Wed,  4 Jan 2012 12:01:31 -0200 (BRST)<br />From: marcos@marcospinguim.com.br<br />To: undisclosed-recipients:;<br /><br />Este post sobre Postfix no blog é loucooooo!<br />.<br /><span style="color: red;">QUIT</span><br />+OK Bye-bye.<br />Connection closed by foreign host.</eric></marcos>{% endhighlight %}</b><br /><b><br /></b><br /><br /><blockquote><b> Obs.: Percebam que as mensagem são arquivos e ficam nas pasta <i>Maildir/cur</i> dos usuários (<i>/home/usuario/Maildir/cu</i>r).<b></b></b></blockquote><br /><b>Pronto, espero que gostem e comentem!</b>